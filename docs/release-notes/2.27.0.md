# Percona Monitoring and Management 2.27.0

<table class="docutils field-list" frame="void" rules="none">
  <colgroup>
    <col class="field-name">
    <col class="field-body">
  </colgroup>
  <tbody valign="top">
    <tr class="field-odd field">
    <th class="field-name">Date:</th>
    <td class="field-body">April 7, 2022</td>
    </tr>
    <tr class="field-even field">
      <th class="field-name">Installation:</th>
      <td class="field-body">
        <a class="reference external" href="https://www.percona.com/software/pmm/quickstart">Installing Percona Monitoring and Management</a></td>
    </tr>
  </tbody>
</table>

Percona Monitoring and Management (PMM) is a free and open-source platform for managing and monitoring MySQL, MongoDB, and PostgreSQL performance.

!!! caution alert alert-warning "Important"
    We recommend using the latest version of the PMM instance. This ensures that you access the latest features of the underlying components, such as VictoriaMetrics, with all the bug fixes in place. One of the critical features of VictoriaMetrics is [stream parsing mode](https://docs.victoriametrics.com/vmagent.html#stream-parsing-mode), which enhances the performance of PMM and saves memory when scraping targets expose millions of metrics.

## Release Highlights

### PMM and Percona Portal Integration

-  **Enhanced UX for connecting PMM server to Percona Portal**: To leverage Percona Platform's recent support for federated identity, PMM now uses access-token authorization for connecting PMM instances to Percona Platform. 

    This replaces the former username/password authentication used in PMM 2.26 and older versions.

 - **Access to account information for Percona customers**: Percona customers who connect their PMM instances to the Percona Platform will now be able to see their account Entitlements and Support tickets.

### Advisors

- **Broader database health assessments with Advisors**: PMM 2.27 introduces new sets of checks to cover additional database health assessments. All checks are grouped into sets of Advisors, according to the functionality and recommendations they provide.

- **New Paid tier and special Advisor checks for customers**: Customers who connect their PMM instance to Percona Platform now also have access to paid Advisor checks, which offer more advanced database health information.
- Advisor checks have been extended with two new query types: *GetDiagnosticData* and *replSetGetStatus*. 

- Improved the documentation around [developing checks](https://github.com/percona/pmm-doc/blob/NewMongoDBChecks/docs/details/develop-checks.md).

### Components upgrade
  - Grafana: PMM 2.27.0 has now migrated to Grafana 8.3.5. This version of Grafana is loaded with a gamut of exciting features. For more information, see [What's new in Grafana v8.0](https://grafana.com/docs/grafana/latest/whatsnew/whats-new-in-v8-0/).
  - VictoriaMetrics: VictoriaMetrics has been upgraded to 1.72.0.

### DBaas

Simplified experience in registering EKS cluster with kubeconfig generated by eksctl.

## New Features

- [PMM-9718](https://jira.percona.com/browse/PMM-9718): Federated connections to Percona Platform.

- [PMM-9473](https://jira.percona.com/browse/PMM-9473): Additional abilities for MongoDB Advisor Checks.

- [PMM-9305](https://jira.percona.com/browse/PMM-9305), [PMM-8661](https://jira.percona.com/browse/PMM-8661): Visibility over Percona Platform Entitlements and Support Tickets.

- [PMM-8800](https://jira.percona.com/browse/PMM-8800): With PMM, you can now have a simplified experience in registering your EKS cluster with kubeconfig generated by eksctl. Copy-paste the configuration by selecting Using Amazon Elastic Kubernetes Service (EKS) checkbox, and your K8s cluster is registered.

- [PMM-8434](https://jira.percona.com/browse/PMM-8434): Support for passing PMM Server Public Address as an environment variable while starting the PMM server.


## Improvements

- [PMM-9648](https://jira.percona.com/browse/PMM-9648): With PMM 2.27.0 migrating to Grafana 8.0, the Singlestat Panel has been deprecated and replaced with Stat Panel in Grafana for an enhanced user experience.

- [PMM-9635](https://jira.percona.com/browse/PMM-9635): Broader database health checks with Advisors.

- [PMM-9542](https://jira.percona.com/browse/PMM-9542): PMM now predefines certain flags that allow users to set all other [VictoriaMetrics parameters](https://docs.victoriametrics.com/#list-of-command-line-flags) as environment variables. For more information see [Documentation](https://www.percona.com/doc/percona-monitoring-and-management/2.x/details/victoria-metrics.html#environment-variables).

- [PMM-9452](https://jira.percona.com/browse/PMM-9452): With this release of PMM, we have implemented a simplified password change method for the default admin user using the command line parameter change-admin-password.

- [PMM-9339](https://jira.percona.com/browse/PMM-9339): The Use TLS option in webhook settings has been renamed to Show TLS setting to better reflect its functionality.
 
- [PMM-9319](https://jira.percona.com/browse/PMM-9319): Synchronized Platform and PMM roles: We have updated PMM permissions to ensure that Administrators of Percona Portal organizations are also granted Admin role in PMM. 

- [PMM-9182](https://jira.percona.com/browse/PMM-9182): Integrated Alerting: Added Silence All  option for when you want to stop notifications from all alerting rules at once.

- [PMM-9164](https://jira.percona.com/browse/PMM-9182): Integrated Alerting: You can now use an existing rule as a source for new ones instead of using a template.
 
- [PMM-9148](https://jira.percona.com/browse/PMM-9148): You can now share a link for Query Analytics at the click of a button with the *Copy Link*.
 
 - [PMM-8794](https://jira.percona.com/browse/PMM-8794): For consistency, we have implemented a unified 24 hours time format for backup management.
 
- [PMM-8045](https://jira.percona.com/browse/PMM-8045): DBaaS: With this version of PMM, we have added a warning about the deletion of API keys so that the user is forewarned before deleting the API key.
  
- [PMM-4466](https://jira.percona.com/browse/PMM-4466): With this release of PMM we have migrated Grafana from using SQLite to PostgreSQL datasource for better performance of Auth sessions.

## Bugs Fixed

 - [PMM-9797](https://jira.percona.com/browse/PMM-9797): Dashboards: Fixed an issue where the data on the Home Dashboard was represented incorrectly on the Stat Panel, which could potentially confuse the user.
 
 - [PMM-9783](https://jira.percona.com/browse/PMM-9783): Query Analytics: Fixed an issue where QAN failed to work after an upgrade.
 
 - [PMM-9757](https://jira.percona.com/browse/PMM-9757): Fixed an issue where the metrics for MongoDB were not being exposed when the database connection was getting lost.
 
 - [PMM-9692](https://jira.percona.com/browse/PMM-9692): Ensured that Technical preview disclaimer message is always displayed in the Percona Platform section in the PMM Settings. 
 
- [PMM-9671](https://jira.percona.com/browse/PMM-9671): Fixed an issue where the PMM configuration was lost due to pmm-managed crashing when the PMM agent version was null.
 
- [PMM-9661](https://jira.percona.com/browse/PMM-9661): Query Analytics: Fixed an issue where QAN layout breaks while resizing the window.
 
- [PMM-9603](https://jira.percona.com/browse/PMM-9603): Fixed “Insufficient access rights” error that was displayed  for admin user after connecting  PMM server connect to Percona Portal. 
  
- [PMM-9570](https://jira.percona.com/browse/PMM-9570): DBaaS: Create DB Cluster dialog box was closing automatically while trying to create  a database cluster and had to be opened twice. This issue has been fixed now.
 
- [PMM-9496](https://jira.percona.com/browse/PMM-9496): DBaaS: Fixed an issue where the host and database were not being monitored in DBaas.
 
 - [PMM-9413](https://jira.percona.com/browse/PMM-9413): Fixed an issue where the PMM management daemon was getting deadlocked when a PMM agent was getting connected with a duplicate agent_id.
 
 - [PMM-9323](https://jira.percona.com/browse/PMM-9323): Ensured PMM no longer downloads checks and templates from Percona Portal when the Telemetry option is disabled in the PMM Advanced Settings.
 
 - [PMM-9015](https://jira.percona.com/browse/PMM-9015): Dashboards: Fixed an issue where PMM does not display when PostgreSQL is down, thus failing to capture the metrics for PostgreSQL.
 
 - [PMM-8986](https://jira.percona.com/browse/PMM-8986): Fixed an issue where the Advisors check on the PMM servers monitoring a large number of database services was causing a timeout. 
 
 
 - [PMM-8203](https://jira.percona.com/browse/PMM-8203): Fixed an issue where the pmm-agent.log is cluttered with unnecessary errors when MariaDB database versions 10.2, 10.3, 10.4, and 10.5 are added for monitoring.
 
 - [PMM-5831](https://jira.percona.com/browse/PMM-5831): Fixed an issue where pmm-admin uses the default value of ‘listen port’ rather than picking up the value from the agent configuration file.
 
 
- Fixed the following CVE’s:

    - [PMM-9726](https://jira.percona.com/browse/PMM-9726): Fixed a critical CVE that was affecting some versions of Go.
    - [PMM-9722](https://jira.percona.com/browse/PMM-9722): Fixed a CVE for ClickHouse DBMS.
    - [PMM-9327](https://jira.percona.com/browse/PMM-9327): Fixed a vulnerability in the Network Security Services (NSS) package.
    - [PMM-9502](https://jira.percona.com/browse/PMM-9502): Fixed multiple JavaScript Common Vulnerabilities and Exposures (CVE) for PMM AMI setup.

# Connect PMM to Percona Platform via access token
PMM recently added support for federated identity. This enables authentication via custom identity providers. To benefit from this enhancement and increase security, PMM now requires access-token authorization for connecting PMM instances to Percona Platform. 

## Test connection in PMM 2.27 Preview 
!!! caution alert alert-warning "Important"
    To test the connection to Percona Platform in this Preview release, you will need to connect your PMM instance to the Percona Platform Development environment. To do this, make sure to specify the following variables with your Docker container: 
- *PERCONA_TEST_SAAS_HOST=check-dev.percona.com*
- *PERCONA_TEST_CHECKS_PUBLIC_KEY=RWTkF7Snv08FCboTne4djQfN5qbrLfAjb8SY3/wwEP+X5nUrkxCEvUDJ*
 
### Connect to Percona Platform
1. In PMM go to **Settings > Percona Platform** tab to fill in the **Connect PMM to Percona Portal** form.
2. The **PMM server ID** field is automatically populated with the ID identified for your PMM instance. Enter the name of your PMM instance and click **Get token** to go to Percona Platform Portal and generate your access token.
3. Log into Percona Platform if you don’t have a current active session.
4. On the **Profile Settings** page, copy the code from the **Percona Platform Access Token field**.
4. Back into PMM, paste the access token into the **Percona Platform Access Token** field and click **Connect**.

To confirm that you have successfully connected the server and check the list of all servers currently connected to an organization, go to [Percona Platform](https://portal.percona.com) > **Dashboard** tab and click **View Instances** next to the **Connect your PMM** step.
