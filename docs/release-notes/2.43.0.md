# Percona Monitoring and Management 2.43.0

| **Release date** | August , 2024                                                                                     |
| -----------------| ----------------------------------------------------------------------------------------------- |
| **Installation** | [Installing Percona Monitoring and Management](../quickstart/index.md) |

Percona Monitoring and Management (PMM) is an open source database monitoring, management, and observability solution for MySQL, PostgreSQL, and MongoDB.

It enables you to observe the health of your database systems, explore new patterns in their behavior, troubleshoot them and execute database management operations regardless of whether your databases are located on-premises or in the cloud.

## What's new in this release

PMM 2.43 brings a host of updates, including redesigned dashboards, new collectors and metrics, enhanced troubleshooting capabilities, strengthened security, and expanded platform support with official ARM compatibility for PMM Client.

Additionally, it features many bug fixes and performance enhancements to improve your user experience.

### MongoDB dashboard improvements and GA of recent experimental dashboard

We've made some significant enhancements to MongoDB monitoring, focusing on redesigned dashboards, streamlined navigation, and general availability of previously experimental dashboards.

!!! note alert alert-primary "Note"
    Experimental dashboards are new or redesigned dashboards initially released as preview features. As experimental dashboards mature and demonstrate their value and stability, they transition to GA status, signifying they are now fully stable and ready for general use.

#### Redesigned dashboards

We've overhauled two critical MongoDB dashboards to provide more value, especially for complex, multi-environment setups:

- **Replica Set Summary**
- **Sharded Cluster Summary** (formerly Cluster Summary)

These dashboards now offer enhanced usability, improved insights, and optimized visualizations for complex environments. 

They focus on highlighting potential database issues for faster resolution and provide centralized, actionable insights without clutter.

#### General availability of Experimental dashboards

The redesigned dashboards, along with the following previously experimental dashboards, are now generally available:

- **MongoDB Oplog Details**
- **MongoDB Collection Overview**
- **Replica Set Summary**
- **Sharded Cluster Summary** (formerly Cluster Summary)

#### Accessing the new dashboards

You can find the updated dashboards in the **MongoDB** and **Dashboards** sections of the main menu. They replace the previous versions as the default dashboards for MongoDB monitoring.

The old dashboards have been moved to the **Experimental** folder and renamed with **(Old)** appended to their names. Future releases will remove these older versions.

#### Updated MongoDB menu structure

To complement the dashboard improvements, we've also restructured the MongoDB section on the main menu for better navigation and accessibility:

- Reorganized menu for a more intuitive navigation, prioritizing the two updated GA dashboards above.
- Decluttered view by moving older dashboards to the **Experimental** folder or removing them from the menu.
- Added **MongoDB Oplog Details**, **MongoDB Collection Overview**, and **MongoDB Instance Summary** to the main menu.
  
![New MongoDB menu structure](../../docs/_images/new_Mongo_menu.png)

We encourage you to start using the new dashboards to benefit from their enhanced monitoring capabilities. We also invite you to share your feedback in the [PMM forum](https://forums.percona.com/c/percona-monitoring-and-management-pmm/percona-monitoring-and-management-pmm-v2/31).

### New MongoDB collector: CurrentOp

The MongoDB exporter now includes the **CurrentOp** collector, offering visibility into active operations, including the new `mongodb_currentop_query_uptime` metric.

To start the MongoDB exporter with the CurrentOp collector enabled, use the `--enable-all-collectors` flag when adding MongoDB services to your PMM instance:

```sh
pmm-admin add mongodb --enable-all-collectors ...
```

Specifying a limit with `--max-collections` for this collector is not necessary.

!!! note "Operation collection limitation"
    To minimize impact on disk usage, the CurrentOp collector is designed to collect only operations that have been running for longer than 1 minute. This limitation helps focus on potentially problematic long-running operations while keeping data volume manageable.

For more information on MongoDB collectors and metrics, see the [pmm-admin commands documentation](../details/commands/pmm-admin.md).

### Monitoring for Percona Backup for MongoDB

PMM now includes support for monitoring your Percona Backup for MongoDB (PBM) setup, providing valuable insights with metrics related to `pbm-agent` statuses, PITR (Point-In-Time Recovery) configuration, and backup statuses.

This new functionality is enabled through a dedicated PBM collector within the MongoDB exporter, allowing you to easily monitor your PBM setup with the following metrics:

- `mongodb_pbm_cluster_backup_configured`
- `mongodb_pbm_agent_status`
- `mongodb_pbm_cluster_pitr_backup_enabled`
- `mongodb_pbm_backup_size`
- `mongodb_pbm_backup_duration_seconds`

These metrics are enabled by default. If you’re already using PBM, you’ll automatically start receiving these metrics without additional configuration.

### Improved troubleshooting

We've enhanced PMM's troubleshooting capabilities to provide you with better insights and more efficient problem-solving tools:

#### Enhanced PMM Server logs

The default number of log lines for each log file returned by `httsp://<pmm-server>/logs.zip` endpoint has been increased from 1,000 to 50,000.

Additionally, the endpoint now includes a customizable line-count parameter in the download URL, allowing you to specify a custom number of log lines or opt for unlimited log size. For more information, see the [API documentation](https://percona-pmm.readme.io/reference/logs).

#### Streamlined Kubernetes diagnostics 

New PMM Client Docker images now include essential troubleshooting tools:

- `tar` enables easier file transfer in and out of containers using the `kubectl cp` command.
- `curl` allows direct checking of exporters to verify their proper functioning.

### Improved security

This update addresses several security issues related to the GNU C Library (Glibc), specifically affecting the Name Service Cache Daemon (nscd). Additionally, it resolves multiple security vulnerabilities by upgrading various third-party packages.

### Important changes to PMM Update process

To ensure you can access the most up-to-date and secure versions, we've implemented two key changes to the update process:

#### Transition to a dedicated repository

Since July 1st 2024, PMM updates are distributed exclusively through the dedicated `repo.percona.com/pmm2-client` repository. 

To smoothly transition to this repository and verify that your system is correctly configured, download and run our automated script from GitHub: [check_percona_packages.py](https://raw.githubusercontent.com/Percona-Lab/release-aux/main/scripts/check_percona_packages.py).

For detailed instructions and more information about this change, check out [our recent blog post](https://www.percona.com/blog/ensure-the-correct-repositories-are-enabled-for-percona-packages/) and [updated installation instructions](../setting-up/index.md).

#### Update process for older PMM versions

With the migration of PMM’s base image from CentOS 7 to Oracle Linux 9 last year, users running PMM version 2.38 or earlier may experience issues when updating PMM to the latest version using the UI **Update** button.

To avoid these issues and ensure you continue receiving updates:

- **For Docker instances**: perform a one-time Docker update to migrate your installation to the Oracle Linux 9-based image.
- **For Non-Docker Iinstances (OVF/AMI)**: follow the upgrade instructions outlined in our [PMM Modernization blog post](https://www.percona.com/blog/pmm-modernized-enterprise-grade-foundation).

### Experimental ARM support for PMM Client

PMM 2.43 introduces experimental support for ARM architecture in PMM Clients, responding to the growing adoption of ARM in data centers and cloud environments. 

For this, PMM now includes pre-built ARM binaries for key features like `node_exporter` and `mysqld_exporter`, enabling monitoring of ARM-based infrastructure while maintaining compatibility with existing PMM Server installations.

As an experimental feature, ARM support will be refined and stabilized in future releases, paving the way for unified monitoring across x86 and ARM architectures.

#### Upgrading and getting started

If you have been compiling PMM on ARM manually, you can now upgrade to the 2.43 release for official support. The [Set up PMM Client topic](../setting-up/client/index.md) now also includes ARM-specific instructions for new installations.

## Maintenance: QAN Update and PostgreSQL 9.x support changes

As part of our ongoing maintenance efforts, we have upgraded the `pg_query_go` package to version 5. This latest version helps parse PostgreSQL queries in QAN, provides improved functionality, and enables subsequent upgrades of important dependencies.

However, with this change, QAN will no longer be able to list PostgreSQL database tables for versions 9.4, 9.5, and 9.6. Since all PostgreSQL 9.x versions have already reached their end-of-life status, we recommend upgrading to a supported version of PostgreSQL.

If you're looking to upgrade, you can easily [install the latest version of Percona Distribution for PostgreSQL](https://docs.percona.com/postgresql/16/installing.html).

## Improvements

- [PMM-13257](https://perconadev.atlassian.net/browse/PMM-13257): [Dashboards] - PMM 2.43 delivers refined MongoDB dashboards with standardized layouts, improved visual consistency, and enhanced usability across Replica Set, Cluster, Collections, and Oplog views, ensuring a more intuitive and efficient monitoring experience.

- [PMM-13003](https://perconadev.atlassian.net/browse/PMM-13003): [Dashboards] - The **MongoDB ReplSet Summary** dashboard now features a clearer, more organized layout with separate rows for CPU usage, CPU saturation, disk I/O, and network traffic for each node in replica sets with more than three nodes, improving visibility and analysis of multi-node deployments.
  
- [PMM-12982](https://perconadev.atlassian.net/browse/PMM-12982): [Dashboards] -  The **MongoDB ReplSet Summary** dashboard now displays replica set roles (Primary, Secondary, Arbiter) for each node, enhancing visibility and simplifying identification of node functions within the replica set topology.

- [PMM-13258](https://perconadev.atlassian.net/browse/PMM-13258): [Dashboards] - Revamped **MongoDB** dashboard structure, featuring new and updated dashboards for improved monitoring of various MongoDB aspects including replicas, sharded clusters, collections, and oplogs, while moving older dashboards to the **Experimental** folder.

- [PMM-13227](https://perconadev.atlassian.net/browse/PMM-13227): [Dashboards] - Renamed the **MongoDB Cluster Summary** dashboard to **MongoDB Sharded Cluster Summary** to more accurately reflect its focus on sharded cluster environments, reducing potential confusion for users monitoring different MongoDB topologies.

- [PMM-13217](https://perconadev.atlassian.net/browse/PMM-13217): [Dashboards] - The **MongoDB Sharded Cluster Summary** dashboard now displays the versions of mongoS routers alongside shard and config server versions, providing a more comprehensive view of the entire sharded cluster infrastructure.

- [PMM-13183](https://perconadev.atlassian.net/browse/PMM-13183): [Dashboards] - The **Node States** chart in the **MongoDB ReplSet Summary** dashboard now auto-adjusts its size to display all nodes without scrolling, enhancing visibility and ease of monitoring for larger replica sets.

- [PMM-13029](https://perconadev.atlassian.net/browse/PMM-13029): [Dashboards] - Improved filtering consistency across all charts on the **MongoDB Oplog Details** dashboard, including the **Oplog GB/Hour** view, ensuring accurate data representation for selected MongoDB nodes. 
  
- [PMM-13159](https://perconadev.atlassian.net/browse/PMM-13159) [Dashboards] - We have removed the experimental MongoDB **Collection Details** dashboard from PMM. You can now find up-to-date collection information on the new Mongo **Cluster Summary** dashboard, which provides a more comprehensive and accurate view of MongoDB collection metrics. If you have been using the **Collection Details** dashboard, make sure to now check the new **MongoDB Cluster Summary** dashboard for similar information.

- [PMM-13030](https://perconadev.atlassian.net/browse/PMM-13030): [Dashboards] - The **MongoDB Collections Overview** dashboard has been refined to ensure consistent data filtering across all charts, including **Top 5 Hottest Collections** views, aligning with user-selected database contexts for improved clarity and more accurate per-database analysis.
  
- [PMM-12333](https://perconadev.atlassian.net/browse/PMM-12333): [Installation] - The PMM Client tarball installation process has been improved with more user-friendly features, including clearer error messages for permission issues, a helpful usage guide, and better overall guidance, making the setup process more intuitive and less error-prone for users.

- [PMM-13243](https://perconadev.atlassian.net/browse/PMM-13258) - Improved identification and monitoring of MongoDB cluster member roles, particularly for mongos instances, enabling clearer topology visualization and laying the groundwork for more precise alerting in sharded cluster environments.

- [PMM-12957](https://perconadev.atlassian.net/browse/PMM-12957) - Introduced alerting capabilities for Percona Backup for MongoDB (PBM), leveraging newly added PBM-specific metrics to enable proactive monitoring of backup statuses, configurations, and performance across MongoDB deployments.

- [PMM-13054](https://perconadev.atlassian.net/browse/PMM-13054) - The default number of log lines returned by the `/logs.zip` endpoint has been increased from 1,000 to 50,000, with an added option to customize the line count or allow unlimited log size via a parameter in the download URL.
  
- [PMM-13292](https://perconadev.atlassian.net/browse/PMM-13292) - Introduced an improved mechanism to resolve port conflicts when starting multiple PMM agents on the same machine, enhancing reliability and reducing manual intervention in complex monitoring setups.

### Fixed issues

- [PMM-13002](https://perconadev.atlassian.net/browse/PMM-13246): [Dashboards] - Fixed a bug in the **MongoDB ReplSet Summary** dashboard where the **Node Summary** section only displayed information for one node. It now correctly shows data for all nodes in a replica set when **All** is selected, providing a comprehensive view of multi-node deployments.

- [PMM-13277](https://perconadev.atlassian.net/browse/PMM-13277) - PMM 2.43 is now available on the AWS Marketplace, resolving the previous temporary unavailability issue of PMM 2.42.0. Users can directly install or upgrade to PMM 2.43.0 through AWS Marketplace or the PMM UI for access to the latest features and improvements.
  
- [PMM-13246](https://perconadev.atlassian.net/browse/PMM-13246) - Addressed four security vulnerabilities (CVEs) related to the GNU C Library (Glibc), specifically affecting the Name Service Cache Daemon (nscd): [CVE-2024-33599](https://nvd.nist.gov/vuln/detail/CVE-2024-33599), [CVE-2024-33600](https://nvd.nist.gov/vuln/detail/CVE-2024-33600), [CVE-2024-33601](https://nvd.nist.gov/vuln/detail/CVE-2024-33601), [CVE-2024-33602](https://nvd.nist.gov/vuln/detail/CVE-2024-33602).

- [PMM-13255](https://perconadev.atlassian.net/browse/PMM-13255) - Resolved two issues with the MongoDB Replication Lag Alert: one where an error occurred during the import of the alert rule template, and another where the alert description displayed an incorrect current value for the replication lag.

- [PMM-13288](https://perconadev.atlassian.net/browse/PMM-13288) - Fixed an issue where queries longer than 2048 characters in PostgreSQL were not properly parsed for table extraction, now allowing accurate monitoring and analysis of long queries without generating error messages in logs.

- [PMM-12965](https://perconadev.atlassian.net/browse/PMM-12965) - We've improved the **MongoDB replication lag is high** alert template to make sure it:

  - now triggers only for `SECONDARY` nodes that are up and exceed the lag threshold, eliminating false alarms during maintenance.
  - excludes `PRIMARY` nodes from alerts, as they cannot lag behind themselves.

    To ensure you're using the updated alert logic, make sure to recreate any alerts based on this alert rule template.

- [PMM-12451](https://perconadev.atlassian.net/browse/PMM-12451) and [PMM-13017](https://perconadev.atlassian.net/browse/PMM-13017) - Resolved an issue with parsing JSON objects into the correct data types and aligned the explain functionality with the official MongoDB client. These updates enhance consistency with MongoDB's native tools and provide improved performance insights.

- [PMM-13071](https://perconadev.atlassian.net/browse/PMM-13071) - The **Explain** tab on the Query Analytics (QAN) page now properly handles unsupported MongoDB query types. For operations like `INSERT`, which don’t support explain functionality, you will now see a clear message saying that the operation is not explainable. 

    This replaces the previous, confusing error message about duplicate BSON fields, offering more accurate feedback in QAN.