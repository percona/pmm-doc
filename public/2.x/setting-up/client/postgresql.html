

































<title>Percona Monitoring and Management &mdash; PostgreSQL</title>

<head>
    


    
<script src="../../js/version-select.js" type="text/javascript"></script>

<script src="../../js/toctree.js" type="text/javascript"></script>

<script src="../../js/lightgallery.min.js" type="text/javascript"></script>


<script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
</script>

    <link rel="top" title="" href="https://www.percona.com/doc/percona-monitoring-and-management/2.x" />
    
    <link rel="next" title="ProxySQL" href="proxysql.html" />
    
    
</head>

<body>
    <div class="container">
        
<link rel="stylesheet" href="../../css/version-select.css" type="text/css">
<link rel="stylesheet" href="../../css/toctree.css" type="text/css">

        
<script src="../../js/version-select.js" type="text/javascript"></script>

<script src="../../js/toctree.js" type="text/javascript"></script>

<script src="../../js/lightgallery.min.js" type="text/javascript"></script>


<script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
</script>

        <div class="document row">
            <div class="documentwrapper col-md-9 col-md-push-3">
                
<div class="related row">
    <ul class="nav nav-pills">
        
        <li class="right" style="margin-right: 10px">
            <a href="proxysql.html" title="ProxySQL">Next</a>
        </li>
        
        
        <li class="right" style="margin-right: 10px">
            <a href="mongodb.html" title="MongoDB">Previous</a>
        </li>
        
        <li>
            <a href="https://www.percona.com/doc/percona-monitoring-and-management/2.x">Home</a>
        </li>
    </ul>
</div>

                

<div class="small">
    <ul class="list-inline">
        <li class="pull-right">
            <a href="https://github.com/percona/pmm-doc/edit/main/docs/setting-up/client/postgresql.md" target="_blank" title=""><i class="uil uil-pen"></i> <b>Edit this page</b></a>
        </li>
    </ul>
</div>


                <div class="bodywrapper">
                    <div class="body">
                        <h1 id="postgresql">PostgreSQL<a class="headerlink" href="#postgresql" title="Permanent link">&para;</a></h1>
<p>How to set up PMM to monitor a <a href="https://www.postgresql.org/">PostgreSQL</a> or <a href="https://www.percona.com/software/postgresql-distribution">Percona Distribution for PostgreSQL</a> database instance.</p>
<div class="admonition summary alert alert-info">
<p class="admonition-title">Summary</p>
<ul>
<li>Create PMM account and set permissions.</li>
<li>Choose, install and configure an extension:<ul>
<li><code>pg_stat_statements</code>, or,</li>
<li><code>pg_stat_monitor</code>.</li>
</ul>
</li>
<li>Add service.</li>
<li>Check service.</li>
</ul>
</div>
<h2 id="before-you-start">Before you start<a class="headerlink" href="#before-you-start" title="Permanent link">&para;</a></h2>
<p>Check that:</p>
<ul>
<li><a href="../server/index.html">PMM Server is installed</a> and running with a known IP address accessible from the client node.</li>
<li><a href="index.html">PMM Client is installed</a> and the <a href="index.html#register">node is registered with PMM Server</a>.</li>
<li>You have superuser (root) access on the client host.</li>
<li>You have superuser access to any database servers that you want to monitor.</li>
</ul>
<p>(PMM follows <a href="https://www.postgresql.org/support/versioning/">PostgreSQL&rsquo;s end-of-life policy</a>. For specific details on supported platforms and versions, see <a href="https://www.percona.com/services/policies/percona-software-platform-lifecycle/">Perconaâ€™s Software Platform Lifecycle page</a>.)</p>
<h2 id="create-a-database-account-for-pmm">Create a database account for PMM<a class="headerlink" href="#create-a-database-account-for-pmm" title="Permanent link">&para;</a></h2>
<p>We recommend creating a PMM database account that can connect to the <code>postgres</code> database with the <code>SUPERUSER</code> role.</p>
<ol>
<li>
<p>Create a user. This example uses <code>pmm</code>. (Replace <code>******</code> with a strong password of your choice.)</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">pmm</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">SUPERUSER</span><span class="w"> </span><span class="k">ENCRYPTED</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="s1">&#39;******&#39;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>If your database runs on Amazon RDS:</p>
<p><div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">pmm</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">rds_superuser</span><span class="w"> </span><span class="k">ENCRYPTED</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="s1">&#39;******&#39;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
Optionally, you can also set up a connection limit (only if the user is not a SUPERUSER):</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">pmm</span><span class="w"> </span><span class="k">CONNECTION</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</li>
<li>
<p>PMM must be able to log in locally as this user to the PostgreSQL instance. To enable this, edit the <code>pg_hba.conf</code> file. If not already enabled by an existing rule, add:</p>
<div class="highlight"><pre><span></span><code>local   all             pmm                                md5
# TYPE  DATABASE        USER        ADDRESS                METHOD
</code></pre></div>
<p>(Ignore the second line. It is a comment to show field alignment.)</p>
</li>
<li>
<p>Reload the configuration:</p>
<div class="highlight"><pre><span></span><code>su - postgres
psql -c <span class="s2">&quot;select pg_reload_conf()&quot;</span>
</code></pre></div>
</li>
<li>
<p>Check local login.</p>
<div class="highlight"><pre><span></span><code>psql postgres pmm -c <span class="s2">&quot;\conninfo&quot;</span>
</code></pre></div>
</li>
<li>
<p>Enter the password for the <code>pmm</code> user when prompted.</p>
</li>
</ol>
<h2 id="choose-and-configure-an-extension">Choose and configure an extension<a class="headerlink" href="#choose-and-configure-an-extension" title="Permanent link">&para;</a></h2>
<p>Decide which database extension to use, and configure your database server for it. The choices are:</p>
<ol>
<li>
<p><a href="#pg_stat_statements"><code>pg_stat_statements</code></a>, the original extension created by PostgreSQL, part of the <code>postgresql-contrib</code> package available on Linux.</p>
</li>
<li>
<p><a href="#pg_stat_monitor"><code>pg_stat_monitor</code></a> is a new extension created by Percona. It is based on and compatible with <code>pg_stat_statements</code>. <code>pg_stat_monitor</code> has all the features of <code>pg_stat_statements</code>, but adds <em>bucket-based data aggregation</em>.</p>
</li>
</ol>
<p>We recommend choosing only one of these. <strong>If you use both, you will get duplicate metrics.</strong></p>
<div class="admonition caution alert alert-warning">
<p class="admonition-title">Caution</p>
<p>While we recommend use of the newer <code>pg_stat_monitor</code> extension, be aware it is currently in beta phase and unsupported.</p>
</div>
<p>Here are the benefits and drawbacks of each.</p>
<table class="table">
<thead>
<tr>
<th scope="col"></th>
<th scope="col"><i class="uil uil-thumbs-up"></i> Benefits</th>
<th scope="col"><i class="uil uil-thumbs-down"></i> Drawbacks</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pg_stat_statements</code></td>
<td>1. Part of official <code>postgresql-contrib</code> package.</td>
<td>1. No aggregated statistics or histograms.<br>2. No Query Examples.</td>
</tr>
<tr>
<td><code>pg_stat_monitor</code></td>
<td>1. Builds on <code>pg_stat_monitor</code> features.<br>2. Bucket-based aggregation.</td>
<td>1. Beta software.</td>
</tr>
</tbody>
</table>
<div class="admonition note alert alert-primary">
<p class="admonition-title">Bucket-based data aggregation</p>
<p><code>pg_stat_monitor</code> collects statistics and aggregates data in a data collection unit called a <em>bucket</em>. These are linked together to form a <em>bucket chain</em>.</p>
<p>You can specify:</p>
<ul>
<li>the number of buckets (the length of the chain);</li>
<li>how much space is available for all buckets;</li>
<li>a time limit for each bucket&rsquo;s data collection (the <em>bucket expiry</em>).</li>
</ul>
<p>When a bucket&rsquo;s expiration time is reached, accumulated statistics are reset and data is stored in the next available bucket in the chain.</p>
<p>When all buckets in the chain have been used, the first bucket is reused and its contents are overwritten.</p>
<p>If a bucket fills before its expiration time is reached, data is discarded.</p>
</div>
<h3 id="pg_stat_statements"><code>pg_stat_statements</code><a class="headerlink" href="#pg_stat_statements" title="Permanent link">&para;</a></h3>
<h4 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Debian/Ubuntu</p>
<div class="admonition hint">
<p class="admonition-title">Root permissions</p>
<div class="highlight"><pre><span></span><code>apt install -y postgresql-contrib
</code></pre></div>
</div>
</li>
<li>
<p>Red Hat/CentOS</p>
<div class="admonition hint">
<p class="admonition-title">Root permissions</p>
<div class="highlight"><pre><span></span><code>yum install -y postgresql-contrib
</code></pre></div>
</div>
</li>
</ul>
<h4 id="configure">Configure<a class="headerlink" href="#configure" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Add these lines to your <code>postgresql.conf</code> file:</p>
<div class="highlight"><pre><span></span><code>shared_preload_libraries = &#39;pg_stat_statements&#39;
track_activity_query_size = 2048 # Increase tracked query string size
pg_stat_statements.track = all   # Track all statements including nested
track_io_timing = on             # Capture read/write stats
</code></pre></div>
</li>
<li>
<p>Restart the database server. After the restart, the extension starts capturing statistics from every database.</p>
</li>
<li>
<p>Install the extension. </p>
<div class="highlight"><pre><span></span><code>psql postgres postgres -c <span class="s2">&quot;CREATE EXTENSION pg_stat_statements SCHEMA public&quot;</span>
</code></pre></div>
<p>This command creates the view where you can access the collected statistics.</p>
</li>
</ol>
<div class="admonition note alert alert-primary">
<p>We recommend that you create the extension for the <code>postgres</code> database. In this case, you receive access to the statistics collected from every database.    </p>
</div>
<p>You can now <a href="#add-service">add the service</a>.</p>
<h3 id="pg_stat_monitor"><code>pg_stat_monitor</code><a class="headerlink" href="#pg_stat_monitor" title="Permanent link">&para;</a></h3>
<div class="admonition caution alert alert-warning">
<p class="admonition-title">Caution</p>
<p><code>pg_stat_monitor</code> is currently in beta phase and is unsupported.</p>
</div>
<p><code>pg_stat_monitor</code> has been tested with:</p>
<ul>
<li>PostgreSQL versions 11, 12, 13.</li>
<li>Percona Distribution for PostgreSQL versions 11, 12, 13.</li>
</ul>
<h4 id="install_1">Install<a class="headerlink" href="#install_1" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>If you use <em>Percona Distribution for PostgreSQL</em>, you can install the extension with your Linux package manager. See <a href="https://www.percona.com/doc/postgresql/LATEST/installing.html">Installing Percona Distribution for PostgreSQL</a>.</p>
</li>
<li>
<p>If you use <em>PostgreSQL</em> you can install by downloading and compiling the source code. See <a href="https://github.com/percona/pg_stat_monitor#installation">Installing <code>pg_stat_monitor</code></a>.</p>
</li>
</ul>
<h4 id="configure_1">Configure<a class="headerlink" href="#configure_1" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Set or change the value for <code>shared_preload_library</code>.</p>
<p>In your <code>postgresql.conf</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="na">shared_preload_libraries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;pg_stat_monitor&#39;</span><span class="w"></span>
</code></pre></div>
<div class="admonition caution alert alert-warning">
<p class="admonition-title">Caution</p>
<p>If you use both <code>pg_stat_statements</code> and <code>pg_stat_monitor</code>, set <code>pg_stat_monitor</code> <strong>after</strong> <code>pg_stat_statements</code>:</p>
<div class="highlight"><pre><span></span><code><span class="na">shared_preload_libraries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;pg_stat_statements, pg_stat_monitor&#39;</span><span class="w"></span>
</code></pre></div>
</div>
</li>
<li>
<p>Set configuration values.</p>
<p>In your <code>postgresql.conf</code> file:
<div class="highlight"><pre><span></span><code><span class="na">pg_stat_monitor.pgsm_query_max_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2048</span><span class="w"></span>
</code></pre></div></p>
<div class="admonition caution alert alert-warning">
<p class="admonition-title">Caution</p>
<p>It is important to set maximal length of query to 2048 characters or more for PMM to work properly.</p>
</div>
<p>You can get a list of other available settings with <code>SELECT * FROM pg_stat_monitor_settings;</code>.</p>
<div class="admonition note alert alert-primary">
<p>See <a href="https://github.com/percona/pg_stat_monitor/blob/master/docs/USER_GUIDE.md#configuration"><code>pg_stat_monitor</code> GitHub repository</a> for details about available parameters.</p>
</div>
</li>
<li>
<p>Start or restart your PostgreSQL instance. The extension starts capturing statistics from every database.</p>
</li>
<li>
<p>In a <code>psql</code> session:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="n">pg_stat_monitor</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>This command creates the view where you can access the collected statistics.</p>
<div class="admonition note alert alert-primary">
<p>We recommend that you create the extension for the <code>postgres</code> database. In this case, you receive the access to the statistics, collected from every database.</p>
</div>
</li>
<li>
<p>Check the version.</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">pg_stat_monitor_version</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
</li>
</ol>
<h2 id="add-service">Add service<a class="headerlink" href="#add-service" title="Permanent link">&para;</a></h2>
<p>When you have configured your database server, you can add a PostgreSQL service with the user interface or on the command line.</p>
<h3 id="with-the-user-interface">With the user interface<a class="headerlink" href="#with-the-user-interface" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Select <i class="uil uil-cog"></i> <em>Configuration</em> â†’ <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.94602 8.89221L9.6093 9.55549L7.84915 11.3156L6.67493 10.1438L7.33821 9.48049L7.84915 9.99143L8.94602 8.89221Z" fill="#000"></path><path d="M16.4273 2.4679V4.04524H7.57258V2.4679H3.1593V22.6406H20.8382V2.4679H16.4273ZM5.87805 19.0429V14.5148H10.4062V19.0429H5.87805ZM11.8288 9.47102H17.7702V10.4085H11.8288V9.47102ZM11.8288 16.3101H17.7702V17.2476H11.8288V16.3101ZM10.4062 7.67571V12.2038H5.87805V7.67571H10.4062Z" fill="#000"></path><path d="M15.7242 1.73906V3.34219H8.27576V1.73906C8.27576 1.53047 8.44685 1.35938 8.65544 1.35938H15.3445C15.5554 1.35938 15.7242 1.53047 15.7242 1.73906Z" fill="#000"></path></svg> <em>PMM Inventory</em> â†’ <svg width="16" height="16" class="css-6tlabr" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.9655 1.58789C6.16682 1.58789 1.46613 6.28859 1.46613 12.0873C1.46613 17.8859 6.16682 22.5866 11.9655 22.5866C17.7641 22.5866 22.4648 17.8859 22.4648 12.0873C22.4648 6.28859 17.7641 1.58789 11.9655 1.58789ZM16.0671 12.8059H12.6747V16.1736C12.6747 16.5702 12.3532 16.8917 11.9565 16.8917C11.7582 16.8917 11.5787 16.8114 11.4487 16.6814C11.3187 16.5514 11.2384 16.3719 11.2384 16.1736V12.8059H7.87073C7.47402 12.8059 7.1526 12.4844 7.1526 12.0877C7.1526 11.8894 7.23285 11.7098 7.36286 11.5798C7.49284 11.4499 7.6724 11.3696 7.87073 11.3696H11.2384V7.97714C11.2384 7.58046 11.5599 7.25904 11.9566 7.25904C12.1549 7.25904 12.3344 7.33926 12.4645 7.46927C12.5944 7.59928 12.6747 7.77881 12.6747 7.97714V11.3696H16.0672C16.4639 11.3696 16.7853 11.691 16.7853 12.0877C16.7852 12.4844 16.4638 12.8059 16.0671 12.8059Z" fill="#000"></path></svg> <em>Add Instance</em>.</p>
</li>
<li>
<p>Select <em>PostgreSQL &ndash; Add a remote instance</em>.</p>
</li>
<li>
<p>Enter or select values for the fields.</p>
</li>
<li>
<p>Click <em>Add service</em>.</p>
</li>
</ol>
<p><div class="lightgallery"><a data-sub-html="" href="../../_images/PMM_Add_Instance_PostgreSQL.jpg"><img alt="" src="../../_images/PMM_Add_Instance_PostgreSQL.jpg" /></a></div></p>
<p>If your PostgreSQL instance is configured to use TLS, click on the <em>Use TLS for database connections</em> check box and fill in your TLS certificates and key.</p>
<p><div class="lightgallery"><a data-sub-html="" href="../../_images/PMM_Add_Instance_PostgreSQL_TLS.jpg"><img alt="" src="../../_images/PMM_Add_Instance_PostgreSQL_TLS.jpg" /></a></div></p>
<div class="admonition hint alert alert-success">
<p class="admonition-title">Note</p>
<p>For TLS connection to work SSL needs to be configured in your PostgreSQL instance. Make sure SSL is enabled in the server configuration file <code>postgresql.conf</code>, and that hosts are allowed to connect in the client authentication configuration file <code>pg_hba.conf</code>. (See PostgreSQL documentation on <a href="https://www.postgresql.org/docs/current/ssl-tcp.html">Secure TCP/IP Connections with SSL</a>.)</p>
</div>
<h3 id="on-the-command-line">On the command line<a class="headerlink" href="#on-the-command-line" title="Permanent link">&para;</a></h3>
<p>Add the database server as a service using one of these example commands. If successful, PMM Client will print <code>PostgreSQL Service added</code> with the service&rsquo;s ID and name. Use the <code>--environment</code> and <code>-custom-labels</code> options to set tags for the service to help identify them.</p>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<p>Add instance with default node (<code>&lt;node&gt;-postgresql</code>) and service name.</p>
<div class="highlight"><pre><span></span><code>pmm-admin add postgresql <span class="se">\</span>
--username<span class="o">=</span>pmm <span class="se">\</span>
--password<span class="o">=</span>password <span class="se">\</span>
--server-url<span class="o">=</span>https://admin:admin@X.X.X.X:443 <span class="se">\</span>
--server-insecure-tls
</code></pre></div>
<ul>
<li><code>&lt;user name&gt;</code>: The PostgreSQL PMM user</li>
<li><code>&lt;password&gt;</code>: The PostgreSQL user credentials.</li>
</ul>
<p>The service name and service ID will be automatically chosen.</p>
<p>Add instance with specified node and service name.</p>
<div class="highlight"><pre><span></span><code>pmm-admin add postgresql <span class="se">\</span>
--username<span class="o">=</span>pmm <span class="se">\</span>
--password<span class="o">=</span>password <span class="se">\</span>
--server-url<span class="o">=</span>https://admin:admin@X.X.X.X:443 <span class="se">\</span>
--server-insecure-tls <span class="se">\</span>
</code></pre></div>
<p>Add instance to connect with a UNIX socket.</p>
<div class="highlight"><pre><span></span><code>pmm-admin add postgresql --socket<span class="o">=</span>/var/run/postgresql
</code></pre></div>
<h4 id="connecting-via-ssltls">Connecting via SSL/TLS<a class="headerlink" href="#connecting-via-ssltls" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>pmm-admin add postgresql --tls <span class="se">\</span>
--tls-cert-file<span class="o">=</span>PATHTOCERT <span class="se">\</span>
--tls-ca-file<span class="o">=</span>PATHTOCACERT <span class="se">\</span>
--tls-key-file<span class="o">=</span>PATHTOKEY <span class="se">\</span>
--host<span class="o">=</span>HOST <span class="se">\</span>
--port<span class="o">=</span>PORT <span class="se">\</span>
--username<span class="o">=</span>USER <span class="se">\</span>
--service-name<span class="o">=</span>SERVICE
</code></pre></div>
<p>where:</p>
<ul>
<li><code>PATHTOCERT</code>: Path to client certificate file.</li>
<li><code>PATHTOCACERT</code>: Path to certificate authority file.</li>
<li><code>PATHTOKEY</code>: Path to client key file.</li>
<li><code>HOST</code>: Instance hostname or IP.</li>
<li><code>PORT</code>: PostgreSQL service port number.</li>
<li><code>USER</code>: Database user allowed to connect via TLS. Should match the common name (CN) used in the client certificate.</li>
<li><code>SERVICE</code>: Name to give to the service within PMM.</li>
</ul>
<h2 id="check-the-service">Check the service<a class="headerlink" href="#check-the-service" title="Permanent link">&para;</a></h2>
<h3 id="check-service-pmm-user-interface">Check service - PMM user interface<a class="headerlink" href="#check-service-pmm-user-interface" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Select <i class="uil uil-cog"></i> <em>Configuration</em> â†’ <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.94602 8.89221L9.6093 9.55549L7.84915 11.3156L6.67493 10.1438L7.33821 9.48049L7.84915 9.99143L8.94602 8.89221Z" fill="#000"></path><path d="M16.4273 2.4679V4.04524H7.57258V2.4679H3.1593V22.6406H20.8382V2.4679H16.4273ZM5.87805 19.0429V14.5148H10.4062V19.0429H5.87805ZM11.8288 9.47102H17.7702V10.4085H11.8288V9.47102ZM11.8288 16.3101H17.7702V17.2476H11.8288V16.3101ZM10.4062 7.67571V12.2038H5.87805V7.67571H10.4062Z" fill="#000"></path><path d="M15.7242 1.73906V3.34219H8.27576V1.73906C8.27576 1.53047 8.44685 1.35938 8.65544 1.35938H15.3445C15.5554 1.35938 15.7242 1.53047 15.7242 1.73906Z" fill="#000"></path></svg> <em>PMM Inventory</em> â†’ <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.94602 8.89221L9.6093 9.55549L7.84915 11.3156L6.67493 10.1438L7.33821 9.48049L7.84915 9.99143L8.94602 8.89221Z" fill="#000"></path><path d="M16.4273 2.4679V4.04524H7.57258V2.4679H3.1593V22.6406H20.8382V2.4679H16.4273ZM5.87805 19.0429V14.5148H10.4062V19.0429H5.87805ZM11.8288 9.47102H17.7702V10.4085H11.8288V9.47102ZM11.8288 16.3101H17.7702V17.2476H11.8288V16.3101ZM10.4062 7.67571V12.2038H5.87805V7.67571H10.4062Z" fill="#000"></path><path d="M15.7242 1.73906V3.34219H8.27576V1.73906C8.27576 1.53047 8.44685 1.35938 8.65544 1.35938H15.3445C15.5554 1.35938 15.7242 1.53047 15.7242 1.73906Z" fill="#000"></path></svg> <em>Inventory list</em>.</p>
</li>
<li>
<p>Look in the <em>Services</em> tab for a matching <em>Service Type</em> (PostgreSQL), <em>Service name</em>, <em>Addresses</em>, and any other details entered in the form.</p>
</li>
<li>
<p>Look in the <em>Agents</em> tab to check the desired data source is being used.</p>
</li>
</ol>
<h3 id="check-service-command-line">Check service - Command line<a class="headerlink" href="#check-service-command-line" title="Permanent link">&para;</a></h3>
<p>Look for your service in the output of this command.</p>
<div class="highlight"><pre><span></span><code>pmm-admin inventory list services
</code></pre></div>
<div class="admonition hint alert alert-success">
<p>If using Docker, use <code>docker exec pmm-client pmm-admin inventory list services</code></p>
</div>
<h3 id="check-data">Check data<a class="headerlink" href="#check-data" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Open the <em>PostgreSQL Instance Summary</em> dashboard.</p>
</li>
<li>
<p>Set the <em>Service Name</em> to the newly-added service.</p>
</li>
</ol>
<h3 id="running-custom-queries">Running custom queries<a class="headerlink" href="#running-custom-queries" title="Permanent link">&para;</a></h3>
<p>The Postgres exporter can run custom queries to add new metrics not provided by default.<br />
Those custom queries must be defined in the <code>/usr/local/percona/pmm2/collectors/custom-queries/postgresql</code> in the same host where the exporter is
running. There are 3 directories inside it:
    - high-resolution/   - every 5 seconds
    - medium-resolution/ - every 10 seconds
    - low-resolution/ - every 60 seconds</p>
<p>Depending on the desired resolution for your custom queries, you can place a file with the queries definition.
The file is a yaml where each query can have these fields:</p>
<p>query_name:
   query: the query definition
   master: boolean to specify if the query should be executed only in the master
   metrics:
     - metric name:
         usage: GAUGE, LABEL, COUNTER, MAPPEDMETRIC or DURATION
         description: a human readable description</p>
<h4 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<p>pg_postmaster_uptime:
   query: &ldquo;select extract(epoch from current_timestamp - pg_postmaster_start_time()) as seconds&rdquo;
   master: true
   metrics:
     - seconds:
         usage: &ldquo;GAUGE&rdquo;
         description: &ldquo;Service uptime&rdquo;</p>
<p>Check the see also section for a more detailed description on MySQL custom queries with more examples about how to use custom queries in dashboards.</p>
<div class="admonition seealso alert alert-info">
<p class="admonition-title">See also</p>
<ul>
<li><a href="../../details/commands/pmm-admin.html#postgresql"><code>pmm-admin</code> man page for <code>pmm-admin add postgresql</code></a></li>
<li><a href="https://www.percona.com/doc/percona-repo-config/percona-release.html">Configuring Percona Repositories with percona-release</a></li>
<li><a href="https://www.percona.com/blog/2020/06/10/running-custom-queries-in-percona-monitoring-and-management/">Percona Blog &ndash; Running Custom MySQL Queries in Percona Monitoring and Management</a></li>
</ul>
</div>
                    </div>
                </div>
                
<div class="small">
    <ul class="list-inline">
        
        <li class="left">
            <i class="uil uil-refresh"></i> Page updated 2021-12-22
        </li>
        
    </ul>
</div>

                
<div class="related row">
    <ul class="nav nav-pills">
        
        <li class="right" style="margin-right: 10px">
            <a href="proxysql.html" title="ProxySQL">Next</a>
        </li>
        
        
        <li class="right" style="margin-right: 10px">
            <a href="mongodb.html" title="MongoDB">Previous</a>
        </li>
        
        <li>
            <a href="https://www.percona.com/doc/percona-monitoring-and-management/2.x">Home</a>
        </li>
    </ul>
</div>

            </div>
            
<div class="sphinxsidebar col-md-3 col-md-pull-9">
    <div class="sphinxsidebarwrapper">
        {@ product_logo @}
        {@ product_pdf_download @}
        
<section class="select-wrapper" id="version-select-wrapper">
    <!-- Empty locator section for version selector -->
</section>

        <h3 id="toctree-heading"><a href="https://www.percona.com/doc/percona-monitoring-and-management/2.x">Contents</a></h3>
        

<ul class="toctree" id="toctree">


<li class="toctree-l1">
    <a class="reference internal" href="../../index.html">Welcome</a>




<li class="toctree-l1">
    <a class="reference internal" href="../index.html">Setting up</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../server/index.html">Server</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../server/network.html">Network</a>




<li class="toctree-l3">
    <a class="reference internal" href="../server/docker.html">Docker</a>




<li class="toctree-l3">
    <a class="reference internal" href="../server/virtual-appliance.html">Virtual Appliance</a>




<li class="toctree-l3">
    <a class="reference internal" href="../server/aws.html">AWS Marketplace</a>




<li class="toctree-l3">
    <a class="reference internal" href="../server/easy-install.html">Easy-install script</a>




<li class="toctree-l3">
    <a class="reference internal" href="../server/dbaas.html">DBaaS</a>



</ul>





<li class="toctree-l2">
    <a class="reference internal" href="index.html">Client</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="mysql.html">MySQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="mongodb.html">MongoDB</a>




<li class="toctree-l3">
    <a class="reference internal" href="postgresql.html">PostgreSQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="proxysql.html">ProxySQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="aws.html">Amazon RDS</a>




<li class="toctree-l3">
    <a class="reference internal" href="azure.html">Microsoft Azure</a>




<li class="toctree-l3">
    <a class="reference internal" href="google.html">Google Cloud Platform</a>




<li class="toctree-l3">
    <a class="reference internal" href="linux.html">Linux</a>




<li class="toctree-l3">
    <a class="reference internal" href="external.html">External Services</a>




<li class="toctree-l3">
    <a class="reference internal" href="haproxy.html">HAProxy</a>




<li class="toctree-l3">
    <a class="reference internal" href="remote.html">Remote instances</a>



</ul>




</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../using/index.html">Using</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../using/interface.html">User Interface</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/alerting.html">Integrated Alerting</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/backup.html">Backup and Restore</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/query-analytics.html">Query Analytics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/dbaas.html">DBaaS</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/security-threat-tool.html">Security Threat Tool</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../how-to/index.html">How to</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/configure.html">Configure</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/upgrade.html">Upgrade</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/secure.html">Secure</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/optimize.html">Optimize</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/annotate.html">Annotate</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/render-dashboard-images.html">Render dashboard images</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/extend-metrics.html">Extend Metrics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/troubleshoot.html">Troubleshoot</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../details/index.html">Details</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../details/architecture.html">Architecture</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../details/interface.html">UI components</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../details/dashboards/index.html">Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-home.html">Insight</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-advanced-data-exploration.html">Advanced Data Exploration</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-victoriametrics.html">VictoriaMetrics</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-victoriametrics-agents-overview.html">VictoriaMetrics Agents Overview</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-inventory.html">PMM</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-cpu-utilization-details.html">OS Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-disk-details.html">Disk Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-network-details.html">Network Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-memory-details.html">Memory Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-node-temperature-details.html">Node Temperature Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-nodes-compare.html">Nodes Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-nodes-overview.html">Nodes Overview</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-node-summary.html">Node Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-numa-details.html">NUMA Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-processes-details.html">Processes Details</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-prometheus-exporter-status.html">Prometheus Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-prometheus-exporters-overview.html">Prometheus Exporters Overview</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-amazon-aurora-details.html">MySQL Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-command-handler-counters-compare.html">MySQL Command/Handler Counters Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-innodb-compression-details.html">MySQL InnoDB Compression Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-innodb-details.html">MySQL InnoDB Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-myisam-aria-details.html">MySQL MyISAM/Aria Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-myrocks-details.html">MySQL MyRocks Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-instance-summary.html">MySQL Instance Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-instances-compare.html">MySQL Instances Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-instances-overview.html">MySQL Instances Overview</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-wait-event-analyses-details.html">MySQL Wait Event Analyses Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-performance-schema-details.html">MySQL Performance Schema Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-query-response-time-details.html">MySQL Query Response Time Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-replication-summary.html">MySQL Replication Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-group-replication-summary.html">MySQL Group Replication Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-table-details.html">MySQL Table Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-user-details.html">MySQL User Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-tokudb-details.html">MySQL TokuDB Details</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-cluster-summary.html">MongoDB Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-instance-summary.html">MongoDB Instance Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-instances-overview.html">MongoDB Instances Overview</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-instances-compare.html">MongoDB Instances Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-replset-summary.html">MongoDB ReplSet Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-inmemory-details.html">MongoDB InMemory Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-mmapv1-details.html">MongoDB MMAPv1 Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-wiredtiger-details.html">MongoDB WiredTiger Details</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-postgresql-instances-overview.html">PostgreSQL Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-postgresql-instance-summary.html">PostgreSQL Instance Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-postgresql-instances-compare.html">PostgreSQL Instances Compare</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-proxysql-instance-summary.html">ProxySQL Dashboards</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-pxc-galera-node-summary.html">HA Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-pxc-galera-cluster-summary.html">PXC/Galera Cluster Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-pxc-galera-nodes-compare.html">PXC/Galera Nodes Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-haproxy-instance-summary.html">HAProxy Instance Summary</a>



</ul>




</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../../details/commands/index.html">Commands</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../details/commands/pmm-admin.html">pmm-admin - PMM Administration Tool</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../details/commands/pmm-agent.html">pmm-agent - PMM Client agent</a>



</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../../details/api.html">API</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../details/victoria-metrics.html">VictoriaMetrics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../details/glossary.html">Glossary</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../faq.html">FAQ</a>




<li class="toctree-l1">
    <a class="reference internal" href="../../release-notes/index.html">Release Notes</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.25.0.html">PMM 2.25.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.24.0.html">PMM 2.24.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.23.0.html">PMM 2.23.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.22.0.html">PMM 2.22.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.21.0.html">PMM 2.21.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.20.0.html">PMM 2.20.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.19.0.html">PMM 2.19.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.18.0.html">PMM 2.18.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.17.0.html">PMM 2.17.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.16.0.html">PMM 2.16.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.15.1.html">PMM 2.15.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.15.0.html">PMM 2.15.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.14.0.html">PMM 2.14.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.13.0.html">PMM 2.13.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.12.0.html">PMM 2.12.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.11.1.html">PMM 2.11.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.11.0.html">PMM 2.11.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.10.1.html">PMM 2.10.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.10.0.html">PMM 2.10.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.9.1.html">PMM 2.9.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.9.0.html">PMM 2.9.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.8.0.html">PMM 2.8.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.7.0.html">PMM 2.7.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.6.1.html">PMM 2.6.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.6.0.html">PMM 2.6.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.5.0.html">PMM 2.5.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.4.0.html">PMM 2.4.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.3.0.html">PMM 2.3.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.2.2.html">PMM 2.2.2</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.2.1.html">PMM 2.2.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.2.0.html">PMM 2.2.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.1.0.html">PMM 2.1.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.0.1.html">PMM 2.0.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.0.0.html">PMM 2.0.0</a>



</ul>




</ul>


        

<h4>Previous page</h4>
<p class="topless">
    <a href="mongodb.html" title="previous chapter">MongoDB</a>
</p>


<h4>Next page</h4>
<p class="topless">
    <a href="proxysql.html" title="next chapter">ProxySQL</a>
</p>


        {@ product_series @}
    </div>
</div>

            <div class="clearer"></div>
        </div>
    </div>
</body>