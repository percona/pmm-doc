

































<title>Percona Monitoring and Management &mdash; DBaaS</title>

<head>
    


    
<script src="../../js/version-select.js" type="text/javascript"></script>

<script src="../../js/toctree.js" type="text/javascript"></script>

<script src="../../js/lightgallery.min.js" type="text/javascript"></script>


<script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
</script>

    <link rel="top" title="" href="https://www.percona.com/doc/percona-monitoring-and-management/2.x" />
    
    <link rel="next" title="Client" href="../client/index.html" />
    
    
</head>

<body>
    <div class="container">
        
<link rel="stylesheet" href="../../css/version-select.css" type="text/css">
<link rel="stylesheet" href="../../css/toctree.css" type="text/css">

        
<script src="../../js/version-select.js" type="text/javascript"></script>

<script src="../../js/toctree.js" type="text/javascript"></script>

<script src="../../js/lightgallery.min.js" type="text/javascript"></script>


<script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
</script>

        <div class="document row">
            <div class="documentwrapper col-md-9 col-md-push-3">
                
<div class="related row">
    <ul class="nav nav-pills">
        
        <li class="right" style="margin-right: 10px">
            <a href="../client/index.html" title="Client">Next</a>
        </li>
        
        
        <li class="right" style="margin-right: 10px">
            <a href="easy-install.html" title="Easy-install script">Previous</a>
        </li>
        
        <li>
            <a href="https://www.percona.com/doc/percona-monitoring-and-management/2.x">Home</a>
        </li>
    </ul>
</div>

                

<div class="small">
    <ul class="list-inline">
        <li class="pull-right">
            <a href="https://github.com/percona/pmm-doc/edit/main/docs/setting-up/server/dbaas.md" target="_blank" title=""><i class="uil uil-pen"></i> <b>Edit this page</b></a>
        </li>
    </ul>
</div>


                <div class="bodywrapper">
                    <div class="body">
                        <h1 id="dbaas">DBaaS<a class="headerlink" href="#dbaas" title="Permanent link">&para;</a></h1>
<div class="admonition caution alert alert-warning">
<p class="admonition-title">Caution</p>
<p>DBaaS functionality is currently in <a href="../../details/glossary.html#technical-preview">technical preview</a> and is subject to change.</p>
</div>
<h2 id="software-prerequisites">Software prerequisites<a class="headerlink" href="#software-prerequisites" title="Permanent link">&para;</a></h2>
<h3 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h3>
<h4 id="red-hat-centos">Red Hat, CentOS<a class="headerlink" href="#red-hat-centos" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum -y install docker-ce
usermod -a -G docker centos
systemctl <span class="nb">enable</span> docker
systemctl start docker
</code></pre></div>
<h4 id="debian-ubuntu">Debian, Ubuntu<a class="headerlink" href="#debian-ubuntu" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>apt-add-repository https://download.docker.com/linux/centos/docker-ce.repo
systemctl <span class="nb">enable</span> docker
systemctl start docker
</code></pre></div>
<h3 id="minikube">minikube<a class="headerlink" href="#minikube" title="Permanent link">&para;</a></h3>
<div class="admonition note alert alert-primary">
<p>Please install minikube 1.16.0</p>
</div>
<h4 id="red-hat-centos_1">Red Hat, CentOS<a class="headerlink" href="#red-hat-centos_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>yum -y install curl
curl -Lo /usr/local/sbin/minikube https://github.com/kubernetes/minikube/releases/download/v1.16.0/minikube-linux-amd64
chmod +x /usr/local/sbin/minikube
ln -s /usr/local/sbin/minikube /usr/sbin/minikube
<span class="nb">alias</span> <span class="nv">kubectl</span><span class="o">=</span><span class="s1">&#39;minikube kubectl --&#39;</span>
</code></pre></div>
<h2 id="start-pmm-server-and-activate-a-dbaas-feature">Start PMM server and activate a DBaaS feature<a class="headerlink" href="#start-pmm-server-and-activate-a-dbaas-feature" title="Permanent link">&para;</a></h2>
<div class="admonition note alert alert-primary">
<ul>
<li>To start a fully-working 3 node XtraDB cluster, consisting of sets of 3x HAProxy, 3x PXC and 6x PMM Client containers, you will need at least 9 vCPU available for minikube. (1x vCPU for HAProxy and PXC and 0.5vCPU for each pmm-client containers).</li>
<li>DBaaS does not depend on PMM Client.</li>
<li>You can pass the environment variable <code>--env ENABLE_DBAAS=1</code> to force the DBaaS feature when starting up pmm-server container. <strong>You can omit the variable and enable the feature later using PMM UI</strong>, please follow the link in step 3. below.</li>
<li>Add the option <code>--network minikube</code> if you run PMM Server and minikube in the same Docker instance. (This will share a single network and the kubeconfig will work.)</li>
<li>Add the options <code>--env PMM_DEBUG=1</code> and/or <code>--env PMM_TRACE=1</code> if you need extended debug details</li>
</ul>
</div>
<ol>
<li>
<p>Start PMM server:</p>
<div class="highlight"><pre><span></span><code>docker run --detach --publish <span class="m">80</span>:80 --publish <span class="m">443</span>:443 --name pmm-server percona/pmm-server:2
</code></pre></div>
</li>
<li>
<p>Change the default administrator credentials from CLI:</p>
<p>(This step is optional, because the same can be done from the web interface of PMM on first login.)</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -t pmm-server bash -c <span class="s1">&#39;ln -s /srv/grafana /usr/share/grafana/data; chown -R grafana:grafana /usr/share/grafana/data; grafana-cli --homepath /usr/share/grafana admin reset-admin-password &lt;RANDOM_PASS_GOES_IN_HERE&gt;&#39;</span>
</code></pre></div>
</li>
</ol>
<div class="admonition caution alert alert-warning">
<p class="admonition-title">Important</p>
<p>You must <a href="../../using/dbaas.html#activate-dbaas">activate DBaaS</a> using the PMM UI if you omitted <code>--env ENABLE_DBAAS=1</code> when starting up the container.</p>
</div>
<h2 id="create-a-kubernetes-cluster">Create a Kubernetes cluster<a class="headerlink" href="#create-a-kubernetes-cluster" title="Permanent link">&para;</a></h2>
<div class="admonition note alert alert-primary">
<p>The DBaaS feature uses Kubernetes clusters to deploy database clusters. You must first create a Kubernetes cluster and then add it to PMM using <code>kubeconfig</code> to get a successful setup.</p>
</div>
<h3 id="minikube_1">Minikube<a class="headerlink" href="#minikube_1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Configure and start minikube:</p>
<div class="highlight"><pre><span></span><code>minikube config <span class="nb">set</span> cpus <span class="m">16</span>
minikube config <span class="nb">set</span> memory <span class="m">32768</span>
minikube config <span class="nb">set</span> kubernetes-version <span class="m">1</span>.20.1
minikube start
</code></pre></div>
</li>
<li>
<p>Get your kubeconfig details from <code>minikube</code>. (You need these to register your Kubernetes cluster with PMM Server):</p>
<div class="highlight"><pre><span></span><code>minikube kubectl -- config view --flatten --minify
</code></pre></div>
<div class="admonition note alert alert-primary">
<p>You will need to copy this output to your clipboard and continue with <a href="../../using/dbaas.html#add-a-kubernetes-cluster">adding a Kubernetes cluster to PMM</a>.</p>
</div>
</li>
</ol>
<h3 id="amazon-aws-eks">Amazon AWS EKS<a class="headerlink" href="#amazon-aws-eks" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create your cluster via <code>eksctl</code> or the Amazon AWS interface. For example:</p>
<div class="highlight"><pre><span></span><code>eksctl create cluster --write-kubeconfig --name<span class="o">=</span>your-cluster-name --zones<span class="o">=</span>us-west-2a,us-west-2b --kubeconfig &lt;PATH_TO_KUBECONFIG&gt;
</code></pre></div>
</li>
<li>
<p>When the cluster is running, modify your kubeconfig file, if it&rsquo;s not utilizing the <code>aws-iam-authenticator</code> or <code>client-certificate</code> method for authentication with Kubernetes. Here are two examples that you can use as templates to modify a copy of your existing kubeconfig:</p>
<ul>
<li>
<p>For the <code>aws-iam-authenticator</code> method:</p>
<div class="highlight"><pre><span></span><code>---
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: &lt;&lt; CERT_AUTH_DATA &gt;&gt;
    server: &lt;&lt; K8S_CLUSTER_URL &gt;&gt;
  name: &lt;&lt; K8S_CLUSTER_NAME &gt;&gt;
contexts:
- context:
    cluster: &lt;&lt; K8S_CLUSTER_NAME &gt;&gt;
    user: &lt;&lt; K8S_CLUSTER_USER &gt;&gt;
  name: &lt;&lt; K8S_CLUSTER_NAME &gt;&gt;
current-context: &lt;&lt; K8S_CLUSTER_NAME &gt;&gt;
kind: Config
preferences: {}
users:
- name: &lt;&lt; K8S_CLUSTER_USER &gt;&gt;
  user:
    exec:
      apiVersion: client.authentication.k8s.io/v1alpha1
      command: aws-iam-authenticator
      args:
        - &quot;token&quot;
        - &quot;-i&quot;
        - &quot;&lt;&lt; K8S_CLUSTER_NAME &gt;&gt;&quot;
        - --region
        - &lt;&lt; AWS_REGION &gt;&gt;
      env:
         - name: AWS_ACCESS_KEY_ID
           value: &quot;&lt;&lt; AWS_ACCESS_KEY_ID &gt;&gt;&quot;
         - name: AWS_SECRET_ACCESS_KEY
           value: &quot;&lt;&lt; AWS_SECRET_ACCESS_KEY &gt;&gt;&quot;
</code></pre></div>
</li>
<li>
<p>For the <code>client-certificate</code> method:</p>
<div class="highlight"><pre><span></span><code>---
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: &lt;&lt; CERT_AUTH_DATA &gt;&gt;
    server: &lt;&lt; K8S_CLUSTER_URL &gt;&gt;
  name: &lt;&lt; K8S_CLUSTER_NAME &gt;&gt;
contexts:
- context:
    cluster: &lt;&lt; K8S_CLUSTER_NAME &gt;&gt;
    user: &lt;&lt; K8S_CLUSTER_USER &gt;&gt;
  name: &lt;&lt; K8S_CLUSTER_NAME &gt;&gt;
current-context: &lt;&lt; K8S_CLUSTER_NAME &gt;&gt;
kind: Config
preferences: {}
users:
- name: &lt;&lt; K8S_CLUSTER_NAME &gt;&gt;
  user:
    client-certificate-data: &lt;&lt; CLIENT_CERT_DATA &gt;&gt;
    client-key-data: &lt;&lt; CLIENT_KEY_DATA &gt;&gt;
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Follow the instructions on <a href="../../using/dbaas.html#add-a-kubernetes-cluster">How to add a Kubernetes cluster</a> with kubeconfig from the previous step.</p>
<div class="admonition note alert alert-primary">
<p>If possible, the connection details will show the cluster&rsquo;s external IP (not possible with minikube).</p>
</div>
</li>
</ol>
<h3 id="google-gke">Google GKE<a class="headerlink" href="#google-gke" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create your cluster either with <a href="https://console.cloud.google.com/">Google Cloud Console</a> or <a href="https://cloud.google.com/sdk/gcloud"><code>gcloud</code> command line tool</a>:</p>
<p>The command below assumes that your <code>gcloud</code> command line tool is properly configured and your user authenticated and authorized to manage GKE Clusters. This example creates a minimal zonal cluster using preemptive node machines, ideal for testing the DBaaS functionality.</p>
<div class="highlight"><pre><span></span><code>gcloud container clusters create --zone europe-west3-c pmm-dbaas-cluster --cluster-version <span class="m">1</span>.19 --machine-type e2-standard-4 --preemptible --num-nodes<span class="o">=</span><span class="m">3</span>
gcloud container clusters get-credentials pmm-dbaas-cluster --zone<span class="o">=</span>europe-west3-c
kubectl create clusterrolebinding cluster-admin-binding --clusterrole<span class="o">=</span>cluster-admin --user<span class="o">=</span><span class="s">&lt;&lt;your_user@your_</span>company.com&gt;&gt;
</code></pre></div>
</li>
<li>
<p>Create <code>ServiceAccount</code>, <code>ClusterRole</code> and <code>RoleBindings</code> (required Roles are deployed automatically when PMM deploys Operators) using the following command:</p>
<div class="highlight"><pre><span></span><code>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: ServiceAccount</span>
<span class="s">metadata:</span>
<span class="s">  name: percona-dbaas-cluster-operator</span>
<span class="s">---</span>
<span class="s">kind: RoleBinding</span>
<span class="s">apiVersion: rbac.authorization.k8s.io/v1beta1</span>
<span class="s">metadata:</span>
<span class="s">  name: service-account-percona-server-dbaas-xtradb-operator</span>
<span class="s">subjects:</span>
<span class="s">- kind: ServiceAccount</span>
<span class="s">  name: percona-dbaas-cluster-operator</span>
<span class="s">roleRef:</span>
<span class="s">  kind: Role</span>
<span class="s">  name: percona-xtradb-cluster-operator</span>
<span class="s">  apiGroup: rbac.authorization.k8s.io</span>
<span class="s">---</span>
<span class="s">kind: RoleBinding</span>
<span class="s">apiVersion: rbac.authorization.k8s.io/v1beta1</span>
<span class="s">metadata:</span>
<span class="s">  name: service-account-percona-server-dbaas-psmdb-operator</span>
<span class="s">subjects:</span>
<span class="s">- kind: ServiceAccount</span>
<span class="s">  name: percona-dbaas-cluster-operator</span>
<span class="s">roleRef:</span>
<span class="s">  kind: Role</span>
<span class="s">  name: percona-server-mongodb-operator</span>
<span class="s">  apiGroup: rbac.authorization.k8s.io</span>
<span class="s">---</span>
<span class="s">apiVersion: rbac.authorization.k8s.io/v1beta1</span>
<span class="s">kind: ClusterRole</span>
<span class="s">metadata:</span>
<span class="s">  name: service-account-percona-server-dbaas-admin</span>
<span class="s">rules:</span>
<span class="s">- apiGroups: [&quot;*&quot;]</span>
<span class="s">  resources: [&quot;*&quot;]</span>
<span class="s">  verbs: [&quot;*&quot;]</span>
<span class="s">---</span>
<span class="s">apiVersion: rbac.authorization.k8s.io/v1beta1</span>
<span class="s">kind: ClusterRoleBinding</span>
<span class="s">metadata:</span>
<span class="s">  name: service-account-percona-server-dbaas-operator-admin</span>
<span class="s">subjects:</span>
<span class="s">- kind: ServiceAccount</span>
<span class="s">  name: percona-dbaas-cluster-operator</span>
<span class="s">  namespace: default</span>
<span class="s">roleRef:</span>
<span class="s">  kind: ClusterRole</span>
<span class="s">  name: service-account-percona-server-dbaas-admin</span>
<span class="s">  apiGroup: rbac.authorization.k8s.io</span>
<span class="s">EOF</span>
</code></pre></div>
</li>
<li>
<p>Extract variables required to generate a kubeconfig:</p>
<div class="highlight"><pre><span></span><code><span class="nv">name</span><span class="o">=</span><span class="sb">`</span>kubectl get serviceAccounts percona-dbaas-cluster-operator -o json <span class="p">|</span> jq  -r <span class="s1">&#39;.secrets[].name&#39;</span><span class="sb">`</span>
<span class="nv">certificate</span><span class="o">=</span><span class="sb">`</span>kubectl get secret <span class="nv">$name</span> -o json <span class="p">|</span> jq -r  <span class="s1">&#39;.data.&quot;ca.crt&quot;&#39;</span><span class="sb">`</span>
<span class="nv">token</span><span class="o">=</span><span class="sb">`</span>kubectl get secret <span class="nv">$name</span> -o json <span class="p">|</span> jq -r  <span class="s1">&#39;.data.token&#39;</span> <span class="p">|</span> base64 -d<span class="sb">`</span>
<span class="nv">server</span><span class="o">=</span><span class="sb">`</span>kubectl cluster-info <span class="p">|</span> grep <span class="s1">&#39;Kubernetes master&#39;</span> <span class="p">|</span> cut -d <span class="s1">&#39; &#39;</span> -f <span class="m">6</span><span class="sb">`</span>
</code></pre></div>
</li>
<li>
<p>Generate your kubeconfig file (copy the output):</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="s2">&quot;</span>
<span class="s2">apiVersion: v1</span>
<span class="s2">kind: Config</span>
<span class="s2">users:</span>
<span class="s2">- name: percona-dbaas-cluster-operator</span>
<span class="s2">  user:</span>
<span class="s2">    token: </span><span class="nv">$token</span><span class="s2"></span>
<span class="s2">clusters:</span>
<span class="s2">- cluster:</span>
<span class="s2">    certificate-authority-data: </span><span class="nv">$certificate</span><span class="s2"></span>
<span class="s2">    server: </span><span class="nv">$server</span><span class="s2"></span>
<span class="s2">  name: self-hosted-cluster</span>
<span class="s2">contexts:</span>
<span class="s2">- context:</span>
<span class="s2">    cluster: self-hosted-cluster</span>
<span class="s2">    user: percona-dbaas-cluster-operator</span>
<span class="s2">  name: svcs-acct-context</span>
<span class="s2">current-context: svcs-acct-context</span>
<span class="s2">&quot;</span>
</code></pre></div>
</li>
<li>
<p>Follow the instructions on <a href="../../using/dbaas.html#add-a-kubernetes-cluster">How to add a Kubernetes cluster</a> with kubeconfig from the previous step.</p>
</li>
</ol>
<h2 id="deleting-clusters">Deleting clusters<a class="headerlink" href="#deleting-clusters" title="Permanent link">&para;</a></h2>
<div class="admonition note alert alert-primary">
<p>If a Public Address is set in PMM Settings, for each DB cluster an API Key is created which can be found on the page <code>/graph/org/apikeys</code>. You should not delete them (for now, until <a href="https://jira.percona.com/browse/PMM-8045">issue PMM-8045</a> is fixed) &ndash; once a DB cluster is removed from DBaaS, the related API Key is also removed.</p>
</div>
<p>For example, if you only run <code>eksctl delete cluster</code> to delete an Amazon EKS cluster without cleaning up the cluster first, there will be a lot of orphaned resources such as Cloud Formations, Load Balancers, EC2 instances, Network interfaces, etc. The same applies for Google GKE clusters.</p>
<h3 id="cleaning-up-kubernetes-cluster">Cleaning up Kubernetes cluster<a class="headerlink" href="#cleaning-up-kubernetes-cluster" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>You should delete all database clusters, backups and restores.</p>
<div class="highlight"><pre><span></span><code>kubectl delete perconaxtradbclusterbackups.pxc.percona.com --all
kubectl delete perconaxtradbclusters.pxc.percona.com --all
kubectl delete perconaxtradbclusterrestores.pxc.percona.com --all

kubectl delete perconaservermongodbbackups.psmdb.percona.com --all
kubectl delete perconaservermongodbs.psmdb.percona.com --all
kubectl delete perconaservermongodbrestores.psmdb.percona.com --all
</code></pre></div>
</li>
<li>
<p>In the <code>dbaas-controller</code> repository, in the deploy directory there are manifests we use to deploy operators. Use them to delete operators and related resources from the cluster.</p>
<div class="admonition caution alert alert-warning">
<p class="admonition-title">Important</p>
<ul>
<li>Do NOT execute this step before all database clusters, backups and restores are deleted in the previous step. It may result in not being able to delete the namespace DBaaS lives in.</li>
<li>Also be careful with this step if you are running DBaaS in more than one namespace as it deletes cluster level CustomResourceDefinitions needed to run DBaaS. This would break DBaaS in other namespaces. Delete just operators deployments in that case.</li>
</ul>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete the PXC operator and related resources.</span>
curl https://raw.githubusercontent.com/percona-platform/dbaas-controller/7a5fff023994cecf6bde15705365114004b50b41/deploy/pxc-operator.yaml <span class="p">|</span> kubectl delete -f -

<span class="c1"># Delete the PSMDB operator and related resources.</span>
curl https://raw.githubusercontent.com/percona-platform/dbaas-controller/7a5fff023994cecf6bde15705365114004b50b41/deploy/psmdb-operator.yaml <span class="p">|</span> kubectl delete -f -
</code></pre></div>
</li>
<li>
<p>Delete the name space where the DBaaS is running, this will delete all remaining name space level resources if any are left.</p>
<div class="highlight"><pre><span></span><code>kubectl delete namespace &lt;your-namespace&gt;
</code></pre></div>
</li>
<li>
<p>Delete the Kubernetes cluster. The method depends on your cloud provider:</p>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/deleting-a-cluster">Delete GKE cluster</a>.</li>
<li><a href="https://docs.aws.amazon.com/eks/latest/userguide/delete-cluster.html">Delete Amazon EKS cluster</a>.</li>
</ul>
</li>
</ol>
<h2 id="run-pmm-server-as-a-docker-container-for-dbaas">Run PMM Server as a Docker container for DBaaS<a class="headerlink" href="#run-pmm-server-as-a-docker-container-for-dbaas" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Start PMM server from a feature branch:</p>
<div class="highlight"><pre><span></span><code>docker run --detach --name pmm-server --publish <span class="m">80</span>:80 --publish <span class="m">443</span>:443 --env <span class="nv">ENABLE_DBAAS</span><span class="o">=</span><span class="m">1</span>  percona/pmm-server:2<span class="p">;</span>
</code></pre></div>
<div class="admonition caution alert alert-warning">
<p class="admonition-title">Important</p>
<ul>
<li>Use <code>--network minikube</code> if running PMM Server and minikube in the same Docker instance. This way they will share single network and the kubeconfig will work.</li>
<li>Use Docker variables <code>--env PMM_DEBUG=1 --env PMM_TRACE=1</code> to see extended debug details.</li>
</ul>
</div>
</li>
<li>
<p>Change the default administrator credentials:</p>
<div class="admonition note alert alert-primary">
<p>This step is optional, because the same can be done from the web interface of PMM on the first login.</p>
</div>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -t pmm-server bash -c <span class="s1">&#39;ln -s /srv/grafana /usr/share/grafana/data; chown -R grafana:grafana /usr/share/grafana/data; grafana-cli --homepath /usr/share/grafana admin reset-admin-password &lt;RANDOM_PASS_GOES_IN_HERE&gt;&#39;</span>
</code></pre></div>
</li>
<li>
<p>Set the public address for PMM Server in PMM settings UI</p>
</li>
<li>
<p>Follow the steps for <a href="../../using/dbaas.html#add-a-kubernetes-cluster">Add a Kubernetes cluster</a>.</p>
</li>
<li>
<p>Follow the steps for <a href="../../using/dbaas.html#add-a-db-cluster">Add a DB Cluster</a>.</p>
</li>
<li>
<p>Get the IP address to connect your app/service:</p>
<div class="highlight"><pre><span></span><code>minikube kubectl get services
</code></pre></div>
</li>
</ol>
<h2 id="exposing-psmdb-and-xtradb-clusters-for-access-by-external-clients">Exposing PSMDB and XtraDB clusters for access by external clients<a class="headerlink" href="#exposing-psmdb-and-xtradb-clusters-for-access-by-external-clients" title="Permanent link">&para;</a></h2>
<p>To make services visible externally, you create a LoadBalancer service or manually run commands to expose ports:</p>
<div class="highlight"><pre><span></span><code>kubectl expose deployment hello-world --type<span class="o">=</span>NodePort.
</code></pre></div>
<div class="admonition seealso alert alert-info">
<p class="admonition-title">See also</p>
<ul>
<li><a href="../../using/dbaas.html">DBaaS Dashboard</a></li>
<li><a href="https://minikube.sigs.k8s.io/docs/start/">Install minikube</a></li>
<li><a href="https://medium.com/@chrisedrego/setting-up-a-standalone-mysql-instance-on-kubernetes-exposing-it-using-nginx-ingress-controller-262fc7af593a">Setting up a Standalone MYSQL Instance on Kubernetes &amp; exposing it using Nginx Ingress Controller</a></li>
<li><a href="https://kubernetes.io/docs/tasks/access-application-cluster/service-access-application-cluster/">Use a Service to Access an Application in a Cluster</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/exposing-apps">Exposing applications using services</a></li>
</ul>
</div>
                    </div>
                </div>
                
<div class="small">
    <ul class="list-inline">
        
        <li class="left">
            <i class="uil uil-refresh"></i> Page updated 2021-07-30
        </li>
        
    </ul>
</div>

                
<div class="related row">
    <ul class="nav nav-pills">
        
        <li class="right" style="margin-right: 10px">
            <a href="../client/index.html" title="Client">Next</a>
        </li>
        
        
        <li class="right" style="margin-right: 10px">
            <a href="easy-install.html" title="Easy-install script">Previous</a>
        </li>
        
        <li>
            <a href="https://www.percona.com/doc/percona-monitoring-and-management/2.x">Home</a>
        </li>
    </ul>
</div>

            </div>
            
<div class="sphinxsidebar col-md-3 col-md-pull-9">
    <div class="sphinxsidebarwrapper">
        {@ product_logo @}
        {@ product_pdf_download @}
        
<section class="select-wrapper" id="version-select-wrapper">
    <!-- Empty locator section for version selector -->
</section>

        <h3 id="toctree-heading"><a href="https://www.percona.com/doc/percona-monitoring-and-management/2.x">Contents</a></h3>
        

<ul class="toctree" id="toctree">


<li class="toctree-l1">
    <a class="reference internal" href="../../index.html">Welcome</a>




<li class="toctree-l1">
    <a class="reference internal" href="../index.html">Setting up</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="index.html">Server</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="network.html">Network</a>




<li class="toctree-l3">
    <a class="reference internal" href="docker.html">Docker</a>




<li class="toctree-l3">
    <a class="reference internal" href="virtual-appliance.html">Virtual Appliance</a>




<li class="toctree-l3">
    <a class="reference internal" href="aws.html">AWS Marketplace</a>




<li class="toctree-l3">
    <a class="reference internal" href="easy-install.html">Easy-install script</a>




<li class="toctree-l3">
    <a class="reference internal" href="dbaas.html">DBaaS</a>



</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../client/index.html">Client</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../client/mysql.html">MySQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/mongodb.html">MongoDB</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/postgresql.html">PostgreSQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/proxysql.html">ProxySQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/aws.html">Amazon RDS</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/azure.html">Microsoft Azure</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/google.html">Google Cloud Platform</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/linux.html">Linux</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/external.html">External Services</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/haproxy.html">HAProxy</a>




<li class="toctree-l3">
    <a class="reference internal" href="../client/remote.html">Remote instances</a>



</ul>




</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../using/index.html">Using</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../using/interface.html">User Interface</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/alerting.html">Integrated Alerting</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/backup.html">Backup and Restore</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/query-analytics.html">Query Analytics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/dbaas.html">DBaaS</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/security-threat-tool.html">Security Threat Tool</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../how-to/index.html">How to</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/configure.html">Configure</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/upgrade.html">Upgrade</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/secure.html">Secure</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/optimize.html">Optimize</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/annotate.html">Annotate</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/render-dashboard-images.html">Render dashboard images</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/extend-metrics.html">Extend Metrics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/troubleshoot.html">Troubleshoot</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../details/index.html">Details</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../details/architecture.html">Architecture</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../details/interface.html">UI components</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../details/dashboards/index.html">Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-home.html">Insight</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-advanced-data-exploration.html">Advanced Data Exploration</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-victoriametrics.html">VictoriaMetrics</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-victoriametrics-agents-overview.html">VictoriaMetrics Agents Overview</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-inventory.html">PMM</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-cpu-utilization-details.html">OS Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-disk-details.html">Disk Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-network-details.html">Network Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-memory-details.html">Memory Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-node-temperature-details.html">Node Temperature Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-nodes-compare.html">Nodes Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-nodes-overview.html">Nodes Overview</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-node-summary.html">Node Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-numa-details.html">NUMA Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-processes-details.html">Processes Details</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-prometheus-exporter-status.html">Prometheus Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-prometheus-exporters-overview.html">Prometheus Exporters Overview</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-amazon-aurora-details.html">MySQL Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-command-handler-counters-compare.html">MySQL Command/Handler Counters Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-innodb-compression-details.html">MySQL InnoDB Compression Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-innodb-details.html">MySQL InnoDB Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-myisam-aria-details.html">MySQL MyISAM/Aria Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-myrocks-details.html">MySQL MyRocks Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-instance-summary.html">MySQL Instance Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-instances-compare.html">MySQL Instances Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-instances-overview.html">MySQL Instances Overview</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-wait-event-analyses-details.html">MySQL Wait Event Analyses Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-performance-schema-details.html">MySQL Performance Schema Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-query-response-time-details.html">MySQL Query Response Time Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-replication-summary.html">MySQL Replication Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-group-replication-summary.html">MySQL Group Replication Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-table-details.html">MySQL Table Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-user-details.html">MySQL User Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mysql-tokudb-details.html">MySQL TokuDB Details</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-cluster-summary.html">MongoDB Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-instance-summary.html">MongoDB Instance Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-instances-overview.html">MongoDB Instances Overview</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-instances-compare.html">MongoDB Instances Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-replset-summary.html">MongoDB ReplSet Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-inmemory-details.html">MongoDB InMemory Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-mmapv1-details.html">MongoDB MMAPv1 Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-mongodb-wiredtiger-details.html">MongoDB WiredTiger Details</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-postgresql-instances-overview.html">PostgreSQL Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-postgresql-instance-summary.html">PostgreSQL Instance Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-postgresql-instances-compare.html">PostgreSQL Instances Compare</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-proxysql-instance-summary.html">ProxySQL Dashboards</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../details/dashboards/dashboard-pxc-galera-node-summary.html">HA Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-pxc-galera-cluster-summary.html">PXC/Galera Cluster Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-pxc-galera-nodes-compare.html">PXC/Galera Nodes Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../details/dashboards/dashboard-haproxy-instance-summary.html">HAProxy Instance Summary</a>



</ul>




</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../../details/commands/index.html">Commands</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../details/commands/pmm-admin.html">pmm-admin - PMM Administration Tool</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../details/commands/pmm-agent.html">pmm-agent - PMM Client agent</a>



</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../../details/api.html">API</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../details/victoria-metrics.html">VictoriaMetrics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../details/glossary.html">Glossary</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../faq.html">FAQ</a>




<li class="toctree-l1">
    <a class="reference internal" href="../../release-notes/index.html">Release Notes</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.25.0.html">PMM 2.25.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.24.0.html">PMM 2.24.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.23.0.html">PMM 2.23.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.22.0.html">PMM 2.22.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.21.0.html">PMM 2.21.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.20.0.html">PMM 2.20.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.19.0.html">PMM 2.19.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.18.0.html">PMM 2.18.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.17.0.html">PMM 2.17.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.16.0.html">PMM 2.16.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.15.1.html">PMM 2.15.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.15.0.html">PMM 2.15.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.14.0.html">PMM 2.14.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.13.0.html">PMM 2.13.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.12.0.html">PMM 2.12.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.11.1.html">PMM 2.11.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.11.0.html">PMM 2.11.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.10.1.html">PMM 2.10.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.10.0.html">PMM 2.10.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.9.1.html">PMM 2.9.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.9.0.html">PMM 2.9.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.8.0.html">PMM 2.8.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.7.0.html">PMM 2.7.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.6.1.html">PMM 2.6.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.6.0.html">PMM 2.6.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.5.0.html">PMM 2.5.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.4.0.html">PMM 2.4.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.3.0.html">PMM 2.3.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.2.2.html">PMM 2.2.2</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.2.1.html">PMM 2.2.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.2.0.html">PMM 2.2.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.1.0.html">PMM 2.1.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.0.1.html">PMM 2.0.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.0.0.html">PMM 2.0.0</a>



</ul>




</ul>


        

<h4>Previous page</h4>
<p class="topless">
    <a href="easy-install.html" title="previous chapter">Easy-install script</a>
</p>


<h4>Next page</h4>
<p class="topless">
    <a href="../client/index.html" title="next chapter">Client</a>
</p>


        {@ product_series @}
    </div>
</div>

            <div class="clearer"></div>
        </div>
    </div>
</body>