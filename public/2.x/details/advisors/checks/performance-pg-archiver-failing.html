

































<title>Percona Monitoring and Management &mdash; PostgreSQL Archiver is failing</title>

<head>
    


    
<script src="../../../js/version-select.js" type="text/javascript"></script>

<script src="../../../js/toctree.js" type="text/javascript"></script>

<script src="../../../js/lightgallery.min.js" type="text/javascript"></script>


<script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
</script>

    <link rel="top" title="" href="https://www.percona.com/doc/percona-monitoring-and-management/2.x" />
    
    
</head>

<body>
    <div class="container">
        
<link rel="stylesheet" href="../../../css/version-select.css" type="text/css">
<link rel="stylesheet" href="../../../css/toctree.css" type="text/css">

        
<script src="../../../js/version-select.js" type="text/javascript"></script>

<script src="../../../js/toctree.js" type="text/javascript"></script>

<script src="../../../js/lightgallery.min.js" type="text/javascript"></script>


<script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
</script>

        <div class="document row">
            <div class="documentwrapper col-md-9 col-md-push-3">
                
<div class="related row">
    <ul class="nav nav-pills">
        
        
        <li>
            <a href="https://www.percona.com/doc/percona-monitoring-and-management/2.x">Home</a>
        </li>
    </ul>
</div>

                

<div class="small">
    <ul class="list-inline">
        <li class="pull-right">
            <a href="https://github.com/percona/pmm-doc/edit/main/docs/details/advisors/checks/performance-pg-archiver-failing.md" target="_blank" title=""><i class="uil uil-pen"></i> <b>Edit this page</b></a>
        </li>
    </ul>
</div>


                <div class="bodywrapper">
                    <div class="body">
                        <h1 id="postgresql-archiver-is-failing">PostgreSQL Archiver is failing<a class="headerlink" href="#postgresql-archiver-is-failing" title="Permanent link">&para;</a></h1>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>For a robust and fault tolerant database solution the implementation of PTIR is a cornerstone of design, for a PostgreSQL database this is covered by the WAL archive process, which will capture the contents of each WAL segment file once it is filled, and save that data somewhere before the segment file is recycled for reuse. </p>
<p>From the official documentation:</p>
<p>To enable WAL archiving, set the wal_level configuration parameter to replica or higher, archive_mode to on, and specify the shell command to use in the <code>archive_command</code> configuration parameter. In practice these settings will always be placed in the postgresql.conf file. In <code>archive_command</code>, <code>%p</code> is replaced by the path name of the file to archive, while <code>%f</code> is replaced by only the file name. (The path name is relative to the current working directory, i.e., the cluster&rsquo;s data directory.) Use <code>%%</code> if you need to embed an actual <code>%</code> character inthe command. The simplest useful command is something like:</p>
<div class="highlight"><pre><span></span><code>archive_command = &#39;test ! -f /mnt/server/archivedir/%f &amp;&amp; cp %p /mnt/server/archivedir/%f&#39;  # Unix
archive_command = &#39;copy &quot;%p&quot; &quot;C:\\server\\archivedir\\%f&quot;&#39;  # Windows
</code></pre></div>
<p>which will copy archivable WAL segments to the directory <code>/mnt/server/archivedir</code> in the above example.</p>
<p>The archive command should return a zero (0) code so PostgreSQL will assume the WAL was successfully archived and will remove it or recycle it, in this manner the WAL directory size will be consistent with no big differences. In the case the command returns a no zero code PostgreSQL wonâ€™t remove or recycle the WAL file and will retry the archive until it success, in the meantime the number of WAL files in the WAL directory will increase and thus the occupied space, with the risk of run out of space.</p>
<h2 id="resolution">Resolution<a class="headerlink" href="#resolution" title="Permanent link">&para;</a></h2>
<p>From the PostgreSQL log we should be able to get insight about the failure, we can even try the command manually to verify the result. </p>
<p>Something to keep in mind is the archive command will be executed under the ownership of the same user that the PostgreSQL server is running as, so the paths, tools, scripts, etc., that are called or acceded from the archive command should be accessible for the user running the service (usually postgres).</p>
<p>In some situations where is critical to release space and avoid the catastrophic failure of running out of free space the archive command can be set to the dummy value <code>/bin/true</code> which in a Linux/Unix environment returns a zero code with no actual action, this is enough for PostgreSQL considers the WAL segment archived and remove/recycle it,. While it might help with urgent needs it is very dangerous, <strong>be aware doing this will break the continuity of the archive</strong>, so basically the PITR is no longer an option unless the initial issue is solved and a new physical backup (filesystem snapshot, pg_basebackup) is taken.</p>
                    </div>
                </div>
                
<div class="small">
    <ul class="list-inline">
        
        <li class="left">
            <i class="uil uil-refresh"></i> Page updated 2021-12-06
        </li>
        
    </ul>
</div>

                
<div class="related row">
    <ul class="nav nav-pills">
        
        
        <li>
            <a href="https://www.percona.com/doc/percona-monitoring-and-management/2.x">Home</a>
        </li>
    </ul>
</div>

            </div>
            
<div class="sphinxsidebar col-md-3 col-md-pull-9">
    <div class="sphinxsidebarwrapper">
        {@ product_logo @}
        {@ product_pdf_download @}
        
<section class="select-wrapper" id="version-select-wrapper">
    <!-- Empty locator section for version selector -->
</section>

        <h3 id="toctree-heading"><a href="https://www.percona.com/doc/percona-monitoring-and-management/2.x">Contents</a></h3>
        

<ul class="toctree" id="toctree">


<li class="toctree-l1">
    <a class="reference internal" href="../../../index.html">Welcome</a>




<li class="toctree-l1">
    <a class="reference internal" href="../../../setting-up/index.html">Setting up</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../../setting-up/server/index.html">Server</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/server/network.html">Network</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/server/docker.html">Docker</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/server/virtual-appliance.html">Virtual Appliance</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/server/aws.html">AWS Marketplace</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/server/easy-install.html">Easy-install script</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/server/dbaas.html">DBaaS</a>



</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../../../setting-up/client/index.html">Client</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/mysql.html">MySQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/mongodb.html">MongoDB</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/postgresql.html">PostgreSQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/proxysql.html">ProxySQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/aws.html">Amazon RDS</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/azure.html">Microsoft Azure</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/google.html">Google Cloud Platform</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/linux.html">Linux</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/external.html">External Services</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/haproxy.html">HAProxy</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../../setting-up/client/remote.html">Remote instances</a>



</ul>




</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../../using/index.html">Using</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../../using/interface.html">User Interface</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../using/alerting.html">Integrated Alerting</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../using/backup.html">Backup and Restore</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../using/query-analytics.html">Query Analytics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../using/dbaas.html">DBaaS</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../using/security-threat-tool.html">Security Threat Tool</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../../how-to/index.html">How to</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../../how-to/configure.html">Configure</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../how-to/upgrade.html">Upgrade</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../how-to/secure.html">Secure</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../how-to/optimize.html">Optimize</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../how-to/annotate.html">Annotate</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../how-to/render-dashboard-images.html">Render dashboard images</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../how-to/extend-metrics.html">Extend Metrics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../how-to/troubleshoot.html">Troubleshoot</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../index.html">Details</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../architecture.html">Architecture</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../interface.html">UI components</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../dashboards/index.html">Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../dashboards/dashboard-home.html">Insight</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-advanced-data-exploration.html">Advanced Data Exploration</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-victoriametrics.html">VictoriaMetrics</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-victoriametrics-agents-overview.html">VictoriaMetrics Agents Overview</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../dashboards/dashboard-inventory.html">PMM</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../dashboards/dashboard-cpu-utilization-details.html">OS Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-disk-details.html">Disk Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-network-details.html">Network Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-memory-details.html">Memory Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-node-temperature-details.html">Node Temperature Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-nodes-compare.html">Nodes Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-nodes-overview.html">Nodes Overview</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-node-summary.html">Node Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-numa-details.html">NUMA Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-processes-details.html">Processes Details</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../dashboards/dashboard-prometheus-exporter-status.html">Prometheus Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-prometheus-exporters-overview.html">Prometheus Exporters Overview</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-amazon-aurora-details.html">MySQL Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-command-handler-counters-compare.html">MySQL Command/Handler Counters Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-innodb-compression-details.html">MySQL InnoDB Compression Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-innodb-details.html">MySQL InnoDB Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-myisam-aria-details.html">MySQL MyISAM/Aria Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-myrocks-details.html">MySQL MyRocks Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-instance-summary.html">MySQL Instance Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-instances-compare.html">MySQL Instances Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-instances-overview.html">MySQL Instances Overview</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-wait-event-analyses-details.html">MySQL Wait Event Analyses Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-performance-schema-details.html">MySQL Performance Schema Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-query-response-time-details.html">MySQL Query Response Time Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-replication-summary.html">MySQL Replication Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-group-replication-summary.html">MySQL Group Replication Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-table-details.html">MySQL Table Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-user-details.html">MySQL User Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mysql-tokudb-details.html">MySQL TokuDB Details</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../dashboards/dashboard-mongodb-cluster-summary.html">MongoDB Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mongodb-instance-summary.html">MongoDB Instance Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mongodb-instances-overview.html">MongoDB Instances Overview</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mongodb-instances-compare.html">MongoDB Instances Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mongodb-replset-summary.html">MongoDB ReplSet Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mongodb-inmemory-details.html">MongoDB InMemory Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mongodb-mmapv1-details.html">MongoDB MMAPv1 Details</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-mongodb-wiredtiger-details.html">MongoDB WiredTiger Details</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../dashboards/dashboard-postgresql-instances-overview.html">PostgreSQL Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-postgresql-instance-summary.html">PostgreSQL Instance Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-postgresql-instances-compare.html">PostgreSQL Instances Compare</a>



</ul>





<li class="toctree-l3">
    <a class="reference internal" href="../../dashboards/dashboard-proxysql-instance-summary.html">ProxySQL Dashboards</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../dashboards/dashboard-pxc-galera-node-summary.html">HA Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-pxc-galera-cluster-summary.html">PXC/Galera Cluster Summary</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-pxc-galera-nodes-compare.html">PXC/Galera Nodes Compare</a>




<li class="toctree-l4">
    <a class="reference internal" href="../../dashboards/dashboard-haproxy-instance-summary.html">HAProxy Instance Summary</a>



</ul>




</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../../commands/index.html">Commands</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../commands/pmm-admin.html">pmm-admin - PMM Administration Tool</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../commands/pmm-agent.html">pmm-agent - PMM Client agent</a>



</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../../api.html">API</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../victoria-metrics.html">VictoriaMetrics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../glossary.html">Glossary</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../../faq.html">FAQ</a>




<li class="toctree-l1">
    <a class="reference internal" href="../../../release-notes/index.html">Release Notes</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.25.0.html">PMM 2.25.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.24.0.html">PMM 2.24.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.23.0.html">PMM 2.23.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.22.0.html">PMM 2.22.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.21.0.html">PMM 2.21.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.20.0.html">PMM 2.20.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.19.0.html">PMM 2.19.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.18.0.html">PMM 2.18.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.17.0.html">PMM 2.17.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.16.0.html">PMM 2.16.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.15.1.html">PMM 2.15.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.15.0.html">PMM 2.15.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.14.0.html">PMM 2.14.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.13.0.html">PMM 2.13.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.12.0.html">PMM 2.12.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.11.1.html">PMM 2.11.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.11.0.html">PMM 2.11.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.10.1.html">PMM 2.10.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.10.0.html">PMM 2.10.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.9.1.html">PMM 2.9.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.9.0.html">PMM 2.9.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.8.0.html">PMM 2.8.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.7.0.html">PMM 2.7.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.6.1.html">PMM 2.6.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.6.0.html">PMM 2.6.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.5.0.html">PMM 2.5.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.4.0.html">PMM 2.4.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.3.0.html">PMM 2.3.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.2.2.html">PMM 2.2.2</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.2.1.html">PMM 2.2.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.2.0.html">PMM 2.2.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.1.0.html">PMM 2.1.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.0.1.html">PMM 2.0.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../../release-notes/2.0.0.html">PMM 2.0.0</a>



</ul>




</ul>


        



        {@ product_series @}
    </div>
</div>

            <div class="clearer"></div>
        </div>
    </div>
</body>