@startuml "PMM containers"
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
!include resources/plantuml_styles.puml
HIDE_STEREOTYPE()
'title PMM Client/PMM Server connections
caption PMM's client/server architecture
Boundary(customer_system1, "User system") {
    System_Ext(database, "Monitored", "Database, node or service")
    Boundary(pmm_client, "PMM Client") {
        System(exporters, "exporters", "Collection of programs, one for each monitored system type")
        System(pmm_agent, "pmm-agent", "Agent invokes relevant exporter when instructed")
        System(vmagent, "vmagent", "VictoriaMetrics agent pushes data to PMM Server")
    }
}
Boundary(customer_system2, "User system") {
    Boundary(pmm_server, "PMM Server") {
        System(pmm_managed, "pmm-managed", "")
        System(query_analytics, "Query Analytics", "")
        System(victoriametrics, "VictoriaMetrics", "Requests (pulls) metrics and stores it")
        System_Ext(grafana, "Grafana", "Data presentation")
    }
}
BiRel_R(pmm_agent, pmm_managed, " ")
Rel(database, exporters, " ")
Rel_R(pmm_agent, database, "Query Analytics metrics")
Rel_D(exporters, vmagent, " ")
Rel_D(pmm_agent, exporters, "Runs")
Rel_R(pmm_managed, query_analytics, " ")
Rel_D(query_analytics, grafana, " ")
Rel(pmm_managed, victoriametrics, " ")
Rel_R(exporters, victoriametrics, "Pull")
Rel_U(vmagent, victoriametrics, "Push")
@enduml
